(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-872e6288"],{"04a7":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",{class:{error:!0,"has-text-right":t.alignRight,"is-hidden":t.hidden}},[t._v("\n  "+t._s(t.text)+"\n")])},n=[],a={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}},o=a,r=s("2877"),c=Object(r["a"])(o,i,n,!1,null,null,null);e["a"]=c.exports},"0bbb":function(t,e,s){"use strict";var i=s("33c0"),n=s.n(i);n.a},"0e61":function(t,e,s){"use strict";var i=s("7918"),n=s.n(i);n.a},"33c0":function(t,e,s){},"45d7":function(t,e,s){},"57d3":function(t,e,s){"use strict";var i=s("de3d"),n=s.n(i);n.a},7918:function(t,e,s){},de3d:function(t,e,s){},f652:function(t,e,s){"use strict";var i=s("45d7"),n=s.n(i);n.a},fd5f:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"breakdown page"},[s("div",{staticClass:"breakdown-columns mt1"},[s("div",{staticClass:"breakdown-column shot-column"},[s("div",{staticClass:"flexrow mb1"},[s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:t.$t("main.csv.import_file"),icon:"upload","is-responsive":!0},on:{click:t.showImportModal}}),s("button-href-link",{staticClass:"flexrow-item",attrs:{title:t.$t("main.csv.export_file"),icon:"download","is-responsive":!0,path:t.exportUrlPath}})],1),t.isShotsLoading?s("spinner",{staticClass:"mt1"}):s("div",{staticClass:"mt1"},[s("combobox",{attrs:{label:t.$t("shots.fields.sequence"),options:t.castingSequenceOptions},model:{value:t.sequenceId,callback:function(e){t.sequenceId=e},expression:"sequenceId"}}),s("p",{staticClass:"shots-title"},[t._v(t._s(t.$t("shots.title")))]),t._l(t.castingSequenceShots,function(e){return s("shot-line",{key:e.id,attrs:{"shot-id":e.id,selected:t.castingCurrentShot&&t.castingCurrentShot.id===e.id,name:e.name},on:{click:t.selectShot}})})],2)],1),s("div",{staticClass:"breakdown-column casting-column"},[s("div",{staticClass:"level"},[s("div",{staticClass:"level-left"},[t.castingCurrentShot?s("h2",{staticClass:"subtitle"},[t._v("\n            "+t._s(t.$t("breakdown.selected_shot",{sequence_name:t.castingCurrentShot.sequence_name,name:t.castingCurrentShot.name}))+"\n          ")]):s("em",[t._v("\n            "+t._s(t.$t("breakdown.select_shot"))+"\n          ")])])]),s("error-text",{attrs:{"align-right":!0,hidden:!t.isSavingError,text:t.$t("breakdown.save_error")}}),t.isLoading?s("spinner"):t._l(t.castingAssetsByType,function(e){return s("div",{key:e.length>0?e[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[t._v("\n          "+t._s(e.length>0?e[0].asset_type_name:"")+"\n        ")]),s("div",{staticClass:"asset-list"},t._l(e,function(e){return s("asset-block",{key:e.id,attrs:{asset:e,"nb-occurences":e.nb_occurences},on:{"remove-one":t.removeOneAsset,"remove-ten":t.removeTenAssets}})}),1)])})],2),t.isCurrentUserManager?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onAssetListScroll,expression:"onAssetListScroll"}],ref:"asset-list",staticClass:"breakdown-column assets-column"},[s("h2",{staticClass:"subtitle"},[t._v("\n        "+t._s(t.$t("breakdown.all_assets"))+"\n      ")]),s("div",{staticClass:"filters-area flexrow"},[s("search-field",{staticClass:"flexrow-item",on:{change:t.onSearchChange}})],1),t.isAssetsLoading?s("spinner"):t._l(t.availableAssetsByType,function(e){return s("div",{key:e.length>0?e[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[t._v("\n          "+t._s(e.length>0?e[0].asset_type_name:"")+"\n        ")]),s("div",{staticClass:"asset-list"},t._l(e,function(e){return s("available-asset-block",{key:e.id,attrs:{asset:e,casted:void 0!==t.casting[e.id],active:!!t.castingCurrentShot},on:{"add-one":t.addOneAsset,"add-ten":t.addTenAssets}})}),1)])})],2):t._e()]),s("import-modal",{attrs:{active:t.modals.importing,"is-loading":t.loading.importing,"is-error":t.errors.importing,"form-data":t.importCsvFormData,columns:t.csvColumns},on:{fileselected:t.selectFile,confirm:t.uploadImportFile,cancel:t.hideImportModal}})],1)},n=[],a=(s("7f7f"),s("ac6a"),s("cebc")),o=s("2f62"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{asset:!0,big:!0,casted:!0,active:t.active},attrs:{id:"casting-"+t.asset.id}},[s("div",{staticClass:"asset-add",on:{click:t.removeOneAsset}},[t._v("\n  - 1\n  ")]),s("div",{staticClass:"asset-add-10",on:{click:t.removeTenAssets}},[t._v("\n  - 10\n  ")]),t.asset.preview_file_id.length>0?s("div",{staticClass:"asset-picture"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"/api/pictures/thumbnails-square/preview-files/"+t.asset.preview_file_id+".png",expression:"'/api/pictures/thumbnails-square/preview-files/' + asset.preview_file_id + '.png'"}]})]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[t._v("\n      no pic\n    ")])]),s("p",{staticClass:"asset-name"},[t._v("\n    "+t._s(t.asset.name)+"\n    "),t.nbOccurences>1?s("span",[t._v("\n    ("+t._s(t.nbOccurences)+")\n    ")]):t._e()])])},c=[],l=(s("c5f6"),{name:"asset-block",props:{asset:{default:function(){return{id:"",name:""}},type:Object},nbOccurences:{default:1,type:Number},active:{default:!0,type:Boolean}},computed:{},methods:{removeOneAsset:function(t){var e=t.target.parentElement.id.substring("casting-".length);this.$emit("remove-one",e)},removeTenAssets:function(t){var e=t.target.parentElement.id.substring("casting-".length);this.$emit("remove-ten",e)}}}),d=l,u=(s("0bbb"),s("2877")),p=Object(u["a"])(d,r,c,!1,null,"9eeaa2e6",null),h=p.exports,m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{asset:!0,casted:t.casted,active:t.active},attrs:{id:"casting-"+t.asset.id}},[s("div",{staticClass:"asset-add",on:{click:t.addOneAsset}},[t._v("\n  + 1\n  ")]),s("div",{staticClass:"asset-add-10",on:{click:t.addTenAssets}},[t._v("\n  + 10\n  ")]),t.asset.preview_file_id.length>0?s("div",{staticClass:"asset-picture"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"/api/pictures/thumbnails-square/preview-files/"+t.asset.preview_file_id+".png",expression:"'/api/pictures/thumbnails-square/preview-files/' + asset.preview_file_id + '.png'"}]})]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[t._v("\n      no pic\n    ")])]),s("p",{staticClass:"asset-name"},[t._v("\n    "+t._s(t.asset.name)+"\n  ")])])},v=[],g={name:"available-asset-block",props:{asset:{default:function(){return{id:"",name:""}},type:Object},casted:{default:!1,type:Boolean},active:{default:!1,type:Boolean}},computed:{},methods:{addOneAsset:function(t){var e=t.target.parentElement.id.substring("casting-".length);this.$emit("add-one",e)},addTenAssets:function(t){var e=t.target.parentElement.id.substring("casting-".length);this.$emit("add-ten",e)}}},f=g,C=(s("f652"),Object(u["a"])(f,m,v,!1,null,"1419806e",null)),_=C.exports,b=s("9355"),S=s("de40"),y=s("992f"),A=s("04a7"),I=s("440f"),k=s("4d04"),w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{shot:!0,selected:t.selected},attrs:{id:t.shotId},on:{click:t.onClicked}},[t._v("\n  "+t._s(t.name)+"\n")])},O=[],E={name:"shot-line",props:{shotId:{default:"",type:String},selected:{default:function(){},type:Boolean},name:{default:"",type:String}},methods:{onClicked:function(t){this.$emit("click",t.target.id)}}},q=E,x=(s("57d3"),Object(u["a"])(q,w,O,!1,null,"66c73c86",null)),$=x.exports,T=s("be83"),L={name:"asset-types",components:{AssetBlock:h,AvailableAssetBlock:_,ButtonHrefLink:b["a"],ButtonSimple:S["a"],Combobox:y["a"],ErrorText:A["a"],ImportModal:I["a"],SearchField:k["a"],ShotLine:$,Spinner:T["a"]},data:function(){return{csvColumns:["Episode","Parent","Name","Asset Type","Asset","Occurences","Label"],importCsvFormData:{},isLoading:!1,isSaving:!1,isSavingError:!1,sequenceId:"",episodeId:"",shotId:"",modals:{importing:!1},loading:{importing:!1},errors:{importing:!1}}},mounted:function(){this.reset(),this.setLastProductionScreen("breakdown")},computed:Object(a["a"])({},Object(o["c"])(["assetMap","assetsByType","currentEpisode","currentProduction","displayedShots","isTVShow","getEpisodeOptions","castingSequenceOptions","isAssetsLoading","isShotsLoading","shots","sequences","shotMap","castingSequenceId","castingCurrentShot","castingSequenceShots","isCastingSaveActive","casting","castingAssetsByType","isCastingDirty","isCastingSaveActive","isCurrentUserManager"]),{availableAssetsByType:function(){var t=[];return this.assetsByType.forEach(function(e){var s=e.filter(function(t){return!t.canceled});s.length>0&&t.push(s)}),t},exportUrlPath:function(){return"/api/export/csv/projects/".concat(this.currentProduction.id,"/casting.csv")}}),methods:Object(a["a"])({},Object(o["b"])(["addAssetToCasting","displayMoreAssets","loadShots","loadAssets","removeAssetFromCasting","saveCasting","setAssetSearch","setCastingEpisode","setCastingSequence","setCastingShot","setLastProductionScreen","uploadCastingFile"]),{reset:function(){var t=this;setTimeout(function(){t.reloadShots()},100)},reloadShots:function(){var t=this;this.loadShots(function(){t.isTVShow?(t.currentEpisode&&(t.episodeId=t.currentEpisode.id),t.setCastingEpisode(t.episodeId)):t.setCastingEpisode(null),t.loadAssets(function(){t.isLoading=!0,t.shotId=t.$route.params.shot_id,t.setCastingShot({shotId:t.shotId,callback:function(){t.isLoading=!1}}),t.displayMoreAssets()})})},onSearchChange:function(t){this.setAssetSearch(t)},selectShot:function(t){var e={name:"breakdown-shot",params:{production_id:this.currentProduction.id,shot_id:t}};this.currentEpisode&&(e.name="episode-breakdown-shot",e.params.episode_id=this.currentEpisode.id),this.$router.push(e)},onSaveClicked:function(){var t=this;this.isSaving=!0,this.isSavingError=!1,this.saveCasting(function(e){e&&(t.isSavingError=!0),t.isSaving=!1})},addOneAsset:function(t){this.addAssetToCasting({assetId:t,nbOccurences:1}),this.saveCasting()},addTenAssets:function(t){this.addAssetToCasting({assetId:t,nbOccurences:10}),this.saveCasting()},removeOneAsset:function(t){this.removeAssetFromCasting({assetId:t,nbOccurences:1}),this.saveCasting()},removeTenAssets:function(t){this.removeAssetFromCasting({assetId:t,nbOccurences:10}),this.saveCasting()},onAssetListScroll:function(t,e){var s=this.$refs["asset-list"],i=s.scrollHeight-s.offsetHeight;i<e.scrollTop+100&&this.displayMoreAssets()},showImportModal:function(){this.modals.importing=!0},hideImportModal:function(){this.modals.importing=!1},selectFile:function(t){this.importCsvFormData=t},uploadImportFile:function(){var t=this;this.loading.importing=!0,this.errors.importing=!1,this.uploadCastingFile(this.importCsvFormData).then(function(){t.loading.importing=!1,t.hideImportModal(),t.reloadShots()}).catch(function(){console.log("bad 2"),t.loading.importing=!1,t.errors.importing=!0})}}),watch:{$route:function(){var t=this.$route.params.shot_id;t&&this.shotId!==t&&(this.shotId=t)},shotId:function(){var t=this;this.shotId&&(this.isLoading=!0,this.setCastingShot({shotId:this.shotId,callback:function(){t.isLoading=!1}}))},sequenceId:function(){this.setCastingSequence(this.sequenceId)},episodeId:function(){this.episodeId,this.$route.params.episode_id},castingSequenceOptions:function(){if(console.log("options changed",this.castingSequenceOptions),this.castingSequenceOptions.length>0){var t=this.shotMap[this.shotId];this.shotId&&t?this.sequenceId=t.sequence_id:this.sequenceId=this.castingSequenceOptions[0].value}else this.sequenceId=""},currentProduction:function(){this.reset()},currentEpisode:function(){this.currentEpisode&&this.episodeId!==this.currentEpisode.id&&this.reset()},sequences:function(){this.$store.commit("CASTING_SET_SEQUENCES",this.sequences)}},metaInfo:function(){return{title:"".concat(this.currentProduction.name," ").concat(this.$t("breakdown.title")," - Kitsu")}}},B=L,F=(s("0e61"),Object(u["a"])(B,i,n,!1,null,"4d9538ec",null));e["default"]=F.exports}}]);
//# sourceMappingURL=chunk-872e6288.2a98733a.js.map