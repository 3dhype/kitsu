{"version":3,"sources":["webpack:///./src/components/pages/Logs.vue?2019","webpack:///./src/components/pages/Logs.vue?55b0","webpack:///src/components/pages/Logs.vue","webpack:///./src/components/pages/Logs.vue?d5ac","webpack:///./src/components/pages/Logs.vue?88dc"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","$t","from","today","model","value","callback","$$v","currentDate","expression","on","loadDayEvents","_v","_s","events","length","isLoading","_e","_l","event","key","id","$event","selectLine","formatDate","created_at","name","split","formatType","directives","rawName","selectedEvents","personMap","user_id","Object","keys","data","sort","isLink","getLink","staticRenderFns","components","ButtonSimple","DateField","PageTitle","PeopleAvatar","PeopleName","Spinner","Date","mounted","computed","methods","substring","loadEvents","after","before","linkKeys","includes","entityType","watch","metaInfo","title","component"],"mappings":"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","file":"js/chunk-66358ab0.ed1d4fa7.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=style&index=0&id=01ab2b59&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logs fixed-page\"},[_c('div',[_c('page-title',{staticClass:\"flexrow-item mb1\",attrs:{\"text\":_vm.$t('logs.title')}})],1),_c('div',{staticClass:\"flexrow\"},[_c('date-field',{staticClass:\"flexrow-item\",attrs:{\"disabled-dates\":{from: _vm.today},\"label\":_vm.$t('logs.current_date_label')},model:{value:(_vm.currentDate),callback:function ($$v) {_vm.currentDate=$$v},expression:\"currentDate\"}}),_c('button-simple',{staticClass:\"flexrow-item\",attrs:{\"icon\":\"refresh\"},on:{\"click\":_vm.loadDayEvents}}),_c('span',{staticClass:\"flexrow-item\"},[_vm._v(\" \"+_vm._s(_vm.events.length)+\" \"+_vm._s(_vm.$t('logs.events'))+\" \")])],1),(!_vm.isLoading && _vm.events.length === 0)?_c('div',{staticClass:\"mt2\"},[_vm._v(\" \"+_vm._s(_vm.$t('logs.empty_list'))+\" \")]):_vm._e(),(_vm.isLoading)?_c('div',{staticClass:\"has-text-centered\"},[_c('spinner')],1):_c('div',{staticClass:\"log-list\"},_vm._l((_vm.events),function(event){return _c('div',{key:event.id,staticClass:\"mt05 event-line\",on:{\"click\":function($event){return _vm.selectLine(event)}}},[_c('div',[_c('span',{staticClass:\"date tag mr1\"},[_vm._v(_vm._s(_vm.formatDate(event.created_at))+\" \")]),_c('span',{staticClass:\"type tag\",attrs:{\"title\":event.name.split(':')[1],\"data-status\":_vm.formatType(event)}},[_vm._v(\" \"+_vm._s(_vm.formatType(event))+\" \")]),_c('span',{staticClass:\"name tag mr1\"},[_vm._v(_vm._s(event.name.split(':')[0]))])]),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selectedEvents[event.id]),expression:\"selectedEvents[event.id]\"}]},[_c('li',{staticClass:\"flexrow\"},[_c('span',{staticClass:\"key\"},[_vm._v(\"user\")]),_c('people-avatar',{staticClass:\"flexrow-item\",attrs:{\"size\":20,\"person\":_vm.personMap[event.user_id]}}),_c('people-name',{staticClass:\"flexrow-item\",attrs:{\"person\":_vm.personMap[event.user_id]}})],1),_vm._l((Object.keys(event.data).sort()),function(key){return _c('li',{key:event.id + '-' + key,staticClass:\"variable\"},[_c('span',{staticClass:\"key\"},[_vm._v(_vm._s(key))]),(_vm.isLink(key))?_c('a',{attrs:{\"href\":_vm.getLink(event, key)}},[_vm._v(\" \"+_vm._s(event.data[key])+\" \")]):_c('span',[_vm._v(_vm._s(event.data[key]))])])})],2)])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"logs fixed-page\">\n    <div>\n      <page-title class=\"flexrow-item mb1\" :text=\"$t('logs.title')\" />\n    </div>\n\n    <div class=\"flexrow\">\n      <date-field\n        class=\"flexrow-item\"\n        :disabled-dates=\"{from: today}\"\n        :label=\"$t('logs.current_date_label')\"\n        v-model=\"currentDate\"\n      />\n      <button-simple\n        class=\"flexrow-item\"\n        icon=\"refresh\"\n        @click=\"loadDayEvents\"\n      />\n      <span class=\"flexrow-item\">\n        {{ events.length }} {{ $t('logs.events') }}\n      </span>\n    </div>\n\n    <div class=\"mt2\" v-if=\"!isLoading && events.length === 0\">\n      {{ $t('logs.empty_list') }}\n    </div>\n    <div class=\"has-text-centered\" v-if=\"isLoading\" >\n      <spinner />\n    </div>\n    <div class=\"log-list\" v-else>\n      <div\n        class=\"mt05 event-line\"\n        :key=\"event.id\"\n        @click=\"selectLine(event)\"\n        v-for=\"event in events\"\n      >\n        <div>\n          <span class=\"date tag mr1\">{{ formatDate(event.created_at) }} </span>\n          <span\n            class=\"type tag\"\n            :title=\"event.name.split(':')[1]\"\n            :data-status=\"formatType(event)\"\n          >\n            {{ formatType(event) }}\n          </span>\n          <span class=\"name tag mr1\">{{ event.name.split(':')[0] }}</span>\n        </div>\n        <ul v-show=\"selectedEvents[event.id]\">\n          <li class=\"flexrow\">\n            <span class=\"key\">user</span>\n            <people-avatar\n              class=\"flexrow-item\"\n              :size=\"20\"\n              :person=\"personMap[event.user_id]\"\n            />\n            <people-name\n              class=\"flexrow-item\"\n              :person=\"personMap[event.user_id]\"\n            />\n          </li>\n          <li\n            class=\"variable\"\n            :key=\"event.id + '-' + key\"\n            v-for=\"key in Object.keys(event.data).sort()\"\n          >\n            <span class=\"key\">{{ key }}</span>\n            <a :href=\"getLink(event, key)\" v-if=\"isLink(key)\">\n              {{ event.data[key] }}\n            </a>\n            <span v-else>{{ event.data[key] }}</span>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\nimport moment from 'moment'\nimport Vue from 'vue'\n\nimport { formatSimpleDate } from '@/lib/time'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple'\nimport DateField from '@/components/widgets/DateField'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar'\nimport PeopleName from '@/components/widgets/PeopleName'\nimport PageTitle from '@/components/widgets/PageTitle'\nimport Spinner from '@/components/widgets/Spinner'\n\nexport default {\n  name: 'logs',\n\n  components: {\n    ButtonSimple,\n    DateField,\n    PageTitle,\n    PeopleAvatar,\n    PeopleName,\n    Spinner\n  },\n\n  data () {\n    return {\n      currentDate: new Date(),\n      events: [],\n      isLoading: true,\n      selectedEvents: {}\n    }\n  },\n\n  mounted () {\n    this.loadDayEvents()\n  },\n\n  computed: {\n    ...mapGetters([\n      'personMap',\n      'productionMap',\n      'user'\n    ]),\n\n    today () {\n      return moment().toDate()\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'loadEvents'\n    ]),\n\n    formatDate (eventDate) {\n      return moment\n        .tz(eventDate, 'UTC')\n        .tz(this.user.timezone)\n        .format('YYYY-MM-DD HH:mm:ss')\n    },\n\n    formatType (event) {\n      return event.name.split(':')[1].substring(0, 3)\n    },\n\n    loadDayEvents () {\n      const before = moment(this.currentDate).add(1, 'days')\n      const after = moment(this.currentDate)\n      this.selectedEvents = {}\n      this.isLoading = true\n      this.loadEvents({\n        after: formatSimpleDate(after),\n        before: formatSimpleDate(before)\n      })\n        .then((events) => {\n          this.isLoading = false\n          this.events = events\n        })\n        .catch((err) => {\n          this.isLoading = false\n          console.error(err)\n        })\n    },\n\n    selectLine (event) {\n      Vue.set(this.selectedEvents, event.id, !this.selectedEvents[event.id])\n    },\n\n    isLink (key) {\n      const linkKeys = ['project_id', 'task_id']\n      return linkKeys.includes(key)\n    },\n\n    getLink (event, key) {\n      const productionId = event.data.project_id\n      const entityType = key.substring(0, key.length - 3)\n      if (entityType === 'project') {\n        return `/productions/${productionId}/news-feed`\n      } else {\n        const entityId = event.data[key]\n        return `/productions/${productionId}/${entityType}s/${entityId}`\n      }\n    }\n  },\n\n  watch: {\n    currentDate () {\n      this.loadDayEvents()\n    }\n  },\n\n  metaInfo () {\n    return {\n      title: `${this.$t('logs.title')} - Kitsu`\n    }\n  }\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.fixed-page {\n  margin-top: 60px;\n  padding: 2em;\n  overflow: scroll;\n}\n\n.log-list {\n  margin-bottom: 2em;\n}\n\n.event-line {\n  cursor: pointer;\n\n  .tag {\n    border-radius: 4px;\n  }\n\n  .date {\n    font-weight: 500;\n  }\n\n  .type {\n    text-transform: uppercase;\n    min-width: 50px;\n  }\n\n  .type[data-status=\"new\"] {\n    color: white;\n    background: $green;\n  }\n\n  .type[data-status=\"upd\"] {\n    color: white;\n    background: $blue;\n  }\n\n  .type[data-status=\"add\"] {\n    color: white;\n    background: $dark-purple;\n  }\n\n  .type[data-status=\"del\"] {\n    color: white;\n    background: $red;\n  }\n\n  .type[data-status=\"sta\"] {\n    color: white;\n    background: $pink;\n  }\n\n  .type[data-status=\"set\"] {\n    background: $light-purple;\n  }\n\n  ul {\n    border-left: 3px solid $light-grey;\n    list-style-type: none;\n    margin: 1em 1em 2em 0.2em;\n    padding-left: 1em;\n\n    .key {\n      font-weight: 500;\n      width: 170px;\n      display: inline-block;\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logs.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Logs.vue?vue&type=template&id=01ab2b59&scoped=true&\"\nimport script from \"./Logs.vue?vue&type=script&lang=js&\"\nexport * from \"./Logs.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Logs.vue?vue&type=style&index=0&id=01ab2b59&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"01ab2b59\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}