(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42029546"],{"44f6":function(e,t,s){"use strict";var i=s("6c13"),n=s.n(i);n.a},"62da":function(e,t,s){},"6c13":function(e,t,s){},9633:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columns fixed-page"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"flexrow project-dates"},[s("div",{staticClass:"flexrow-item"},[s("label",{staticClass:"label"},[e._v("\n          "+e._s(e.$t("main.start_date"))+"\n        ")]),s("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"d MMMM yyyy"},model:{value:e.selectedStartDate,callback:function(t){e.selectedStartDate=t},expression:"selectedStartDate"}})],1),s("div",{staticClass:"flexrow-item field"},[s("label",{staticClass:"label"},[e._v("\n          "+e._s(e.$t("main.end_date"))+"\n        ")]),s("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"d MMMM yyyy"},model:{value:e.selectedEndDate,callback:function(t){e.selectedEndDate=t},expression:"selectedEndDate"}})],1),s("text-field",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"flexrow-item overall-man-days",attrs:{type:"number",label:e.$t("schedule.overall_man_days"),disabled:!e.isCurrentUserAdmin},model:{value:e.overallManDays,callback:function(t){e.overallManDays=t},expression:"overallManDays"}}),s("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(t){e.zoomLevel=t},expression:"zoomLevel"}})],1),s("schedule",{attrs:{"start-date":e.startDate,"end-date":e.endDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":e.loading.schedule,"is-error":e.errors.schedule},on:{"item-changed":e.saveScheduleItem,"change-zoom":e.changeZoom}})],1),e.currentTask?s("div",{staticClass:"column side-column is-hidden-mobile hide-small-screen"},[s("task-info",{attrs:{task:e.currentTask,"is-loading":!1}})],1):e._e()])},n=[],a=(s("7f7f"),s("cebc")),r=s("2f62"),l=s("7f45"),o=s.n(l),d=s("2430"),c=s("fa33"),u=s("2229"),h=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isSimple?s("span",{staticClass:"select"},[s("select",{ref:"select",staticClass:"select-input",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.emitEnter()},change:e.updateValue}},e._l(e.options,function(t,i){return s("option",{key:i+"-"+t.label+"-"+t.value,domProps:{value:t.value||t.label,selected:e.value===t.value}},[e._v("\n      "+e._s(e.getOptionLabel(t))+"\n    ")])}),0)]):s("div",{staticClass:"field"},[e.label.length>0?s("label",{staticClass:"label"},[e._v("\n    "+e._s(e.label)+"\n  ")]):e._e(),s("p",{staticClass:"control"},[s("span",{class:{select:!0}},[s("select",{ref:"select",staticClass:"select-input",attrs:{disabled:e.disabled},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.emitEnter()},change:e.updateValue}},e._l(e.options,function(t,i){return s("option",{key:i+"-"+t.label+"-"+t.value,domProps:{value:t.value||t.label,selected:e.value===t.value}},[e._v("\n          "+e._s(e.getOptionLabel(t))+"\n        ")])}),0)])])])},m=[],f=(s("c5f6"),{name:"combobox",props:{label:{default:"",type:String},value:{default:0,type:Number},options:{default:function(){return[]},type:Array},localeKeyPrefix:{default:"",type:String},isSimple:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean}},computed:{},methods:{updateValue:function(){this.$emit("input",parseInt(this.$refs.select.value))},emitEnter:function(){this.$emit("enter",parseInt(this.$refs.select.value))},getOptionLabel:function(e){return this.localeKeyPrefix.length>0?this.$t(this.localeKeyPrefix+e.label.toLowerCase()):e.label}}}),y=f,p=(s("e007"),s("2877")),D=Object(p["a"])(y,h,m,!1,null,"4e1af092",null),v=D.exports,b=s("9d94"),g=s("7bf8"),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"schedule-wrapper"},[s("div",{ref:"schedule",class:e.scheduleClass},[s("div",{ref:"entity-list",staticClass:"entities",on:{mousedown:e.startBrowsingY}},[s("div",{staticClass:"has-text-right total-man-days"},[s("span",{staticClass:"mr1"},[e._v(e._s(e.totalManDays))]),s("span",[e._v(e._s(e.$t("schedule.md")))])]),e._l(e.hierarchy,function(t){return s("div",{key:"entity-"+t.id,staticClass:"entity-line entity-name",style:e.entityLineStyle(t)},[s("span",{staticClass:"filler"},[e._v("\n        "+e._s(t.name)+"\n        ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.man_days,expression:"rootElement.man_days"}],attrs:{type:"number",placeholder:"0",min:"0"},domProps:{value:t.man_days},on:{input:[function(s){s.target.composing||e.$set(t,"man_days",s.target.value)},function(s){return e.$emit("item-changed",t)}]}}),s("span",{staticClass:"man-days-unit"},[e._v("\n          "+e._s(e.$t("schedule.md"))+"\n        ")])])})],2),s("div",{staticClass:"timeline"},[s("div",{ref:"timeline-header",staticClass:"timeline-header",on:{mousedown:e.startBrowsingX}},e._l(e.daysAvailable,function(t,i){return s("div",{key:"header-"+t.toISOString(),staticClass:"day",style:e.dayStyle(t)},[t.newMonth||0===i?s("span",{staticClass:"month-name"},[e._v("\n            "+e._s(t.format("MMMM"))+"\n          ")]):e._e(),s("div",{class:e.dayClass(t,i)},[!t.weekend&&e.zoomLevel>2?s("span",[e._v("\n              "+e._s(t.format("ddd")[0])+" /\n            ")]):e._e(),t.weekend?e._e():s("span",{staticClass:"day-number"},[e._v("\n              "+e._s(t.format("DD"))+"\n            ")])])])}),0),s("div",{ref:"timeline-content-wrapper",staticClass:"timeline-content-wrapper"},[s("div",{ref:"timeline-content",staticClass:"timeline-content",on:{mousedown:e.startBrowsing,mousewheel:function(t){return e.$emit("change-zoom",t)}}},[s("div",{ref:"timeline-position",staticClass:"timeline-position",style:e.timelinePositionStyle}),e._l(e.hierarchy,function(t){return s("div",{key:"entity-line-"+t.id,staticClass:"entity-line",style:e.entityLineStyle(t)},[s("div",{staticClass:"timebar",style:e.timebarStyle(t)},[s("div",{class:{"timebar-left-hand":e.isCurrentUserAdmin},on:{mousedown:function(s){return e.moveTimebarLeftSide(t,s)}}}),s("div",{staticClass:"filler",on:{mousedown:function(s){return e.moveTimebar(t,s)}}}),s("div",{class:{"timebar-right-hand":e.isCurrentUserAdmin},on:{mousedown:function(s){return e.moveTimebarRightSide(t,s)}}})])])})],2)])])]),s("spinner",{staticClass:"mt1"})],1)},C=[],_=(s("ac6a"),s("6762"),s("2fdb"),s("be83")),S={name:"schedule",components:{Spinner:_["a"]},data:function(){return{isBrowsingX:!1,isBrowsingY:!1,isChangeSize:!1,timelineDisplayedDaysIndex:{}}},props:{endDate:{type:Object,required:!0},hierarchy:{default:function(){return[]},type:Array},startDate:{type:Object,required:!0},zoomLevel:{type:Number,default:2},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!0}},mounted:function(){this.resetScheduleSize(),document.addEventListener("mouseup",this.stopBrowsing),document.addEventListener("mousemove",this.onMouseMove),window.addEventListener("resize",this.resetScheduleSize)},destroyed:function(){document.removeEventListener("mouseup",this.stopBrowsing),document.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("resize",this.resetScheduleSize),document.body.style.cursor="default"},computed:Object(a["a"])({},Object(r["c"])(["isCurrentUserAdmin"]),{cellWidth:function(){return 20*this.zoomLevel},daysAvailable:function(){var e=[],t=this.startDate.add(-1,"days"),s=t.toDate(),i=this.endDate.toDate();s.isoweekday=t.isoWeekday(),s.monthday=t.month();while(s<i){var n=new Date(Number(s));n.setDate(s.getDate()+1),n.isoweekday=s.isoweekday+1,n.isoweekday>7&&(n.isoweekday=1,n.newWeek=!0),n.monthday=s.monthday+1,n.monthday>27&&n.getMonth()!==s.getMonth()&&(n.newMonth=!0,n.monthday=1),[6,7].includes(n.isoweekday)&&(n.weekend=!0);var a=o()(n);a.newWeek=n.newWeek,a.newMonth=n.newMonth,a.weekend=n.weekend,e.push(a),s=n}return e},displayedDays:function(){return this.daysAvailable.filter(function(e){return!e.weekend})},nbDisplayedDays:function(){return this.displayedDays.length},displayedDaysIndex:function(){var e=0,t={};return this.displayedDays.forEach(function(s){t[s.format("YYYY-MM-DD")]=e,e++}),t},scheduleClass:function(){var e={schedule:!0,unselectable:!0};return e["zoom-level-"+this.zoomLevel]=!0,e},timelinePositionStyle:function(){return{width:this.cellWidth+"px"}},totalManDays:function(){return this.hierarchy.reduce(function(e,t){var s=e,i=t.man_days;return t.man_days&&("string"===typeof i&&(i=parseInt(i)),s=e+i),s},0)},entityList:function(){return this.$refs["entity-list"]},schedule:function(){return this.$refs["schedule"]},timelineContent:function(){return this.$refs["timeline-content"]},timelineContentWrapper:function(){return this.$refs["timeline-content-wrapper"]},timelineHeader:function(){return this.$refs["timeline-header"]},timelinePosition:function(){return this.$refs["timeline-position"]}}),methods:Object(a["a"])({},Object(r["b"])([]),{resetScheduleSize:function(){this.timelineContent.style.width=this.nbDisplayedDays*this.cellWidth+"px",this.timelineContentWrapper.style.height=this.schedule.offsetHeight-118+"px",this.entityList.style.height=this.schedule.offsetHeight-118+"px"},onMouseMove:function(e){this.isChangeStartDate?this.changeStartDate(e):this.isChangeEndDate?this.changeEndDate(e):this.isChangeDates?this.changeDates(e):(this.isBrowsingX&&this.scrollScheduleLeft(e),this.isBrowsingY&&this.scrollScheduleTop(e)),this.updatePositionBarPosition(e)},updatePositionBarPosition:function(e){var t=this.timelineContentWrapper.scrollLeft+e.clientX;t-=262,t=Math.round(t/this.cellWidth)*this.cellWidth,this.timelinePosition.style.left=t+"px"},changeDates:function(e){var t=e.clientX-this.initialClientX-this.cellWidth/2,s=Math.ceil(t/this.cellWidth),i=this.lastStartDate.format("YYYY-MM-DD"),n=this.lastEndDate.format("YYYY-MM-DD"),a=this.displayedDaysIndex[i],r=this.displayedDaysIndex[n],l=r-a,o=this.displayedDaysIndex[i];o+=s,o<0&&(o=0);var d=this.displayedDays[o];if(d){var c=this.displayedDays[o+l];c&&(this.currentElement.startDate=d,this.currentElement.endDate=c,this.$emit("item-changed",this.currentElement))}},changeStartDate:function(e){var t=e.clientX-this.initialClientX,s=Math.floor(t/this.cellWidth),i=this.lastStartDate.format("YYYY-MM-DD"),n=this.displayedDaysIndex[i];n+=s;var a=this.displayedDays[n];this.currentElement.startDate=a,this.$emit("item-changed",this.currentElement)},changeEndDate:function(e){var t=e.clientX-this.initialClientX+this.cellWidth/2,s=Math.ceil(t/this.cellWidth),i=this.currentElement.startDate.format("YYYY-MM-DD"),n=this.lastEndDate.format("YYYY-MM-DD"),a=this.displayedDaysIndex[i],r=this.displayedDaysIndex[n];r+=s-1,r<a&&(r=a+1),r>this.displayedDaysIndex.length&&(r=this.displayedDaysIndex.length-1);var l=this.displayedDays[r];this.currentElement.endDate=l,this.$emit("item-changed",this.currentElement)},scrollScheduleLeft:function(e){var t=this.timelineContentWrapper.scrollLeft,s=t-e.movementX;this.timelineContentWrapper.scrollLeft=s,this.timelineHeader.scrollLeft=s},scrollScheduleTop:function(e){var t=this.timelineContentWrapper.scrollTop,s=t-e.movementY;this.timelineContentWrapper.scrollTop=s,this.entityList.scrollTop=s},startBrowsing:function(e){this.isChangeStartDate||this.isChangeEndDate||this.isChangeDates||(document.body.style.cursor="grabbing",this.isBrowsingX=!0,this.isBrowsingY=!0)},startBrowsingX:function(e){document.body.style.cursor="grabbing",this.isBrowsingX=!0},startBrowsingY:function(e){document.body.style.cursor="grabbing",this.isBrowsingY=!0},stopBrowsing:function(e){document.body.style.cursor="default",this.isChangeStartDate=!1,this.isChangeEndDate=!1,this.isChangeDates=!1,this.isBrowsingX=!1,this.isBrowsingY=!1},moveTimebar:function(e,t){!this.isChangeStartDate&&this.isCurrentUserAdmin&&(this.isChangeDates=!0,this.isChangeStartDate=!1,this.isChangeEnd=!1,this.currentElement=e,this.lastStartDate=e.startDate.clone(),this.lastEndDate=e.endDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="ew-resize")},moveTimebarLeftSide:function(e,t){!this.isChangeDates&&this.isCurrentUserAdmin&&(this.isChangeDates=!1,this.isChangeStartDate=!0,this.isChangeEnd=!1,this.currentElement=e,this.lastStartDate=e.startDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="w-resize")},moveTimebarRightSide:function(e,t){!this.isChangeDates&&this.isCurrentUserAdmin&&(this.isChangeDates=!1,this.isChangeStartDate=!1,this.isChangeEndDate=!0,this.currentElement=e,this.lastEndDate=e.endDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="e-resize")},businessDiff:function(e,t){var s=e.clone().endOf("week"),i=t.clone().startOf("week"),n=i.diff(s,"days");if(t.diff(e,"days")>6){var a=5*n/7,r=s.day()-e.day();0===e.day()&&--r;var l=t.day()-i.day();return 6===t.day()&&--l,r+a+l-1}var d=o()(e),c=0;while(d.isBefore(t,"day"))0!==d.day()&&6!==d.day()&&c++,d.add(1,"days");return c},dayClass:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{"day-name":!0,"new-week":e.newWeek||!1,"new-month":e.newMonth||0===t||!1}},dayStyle:function(e){return{"min-width":e.weekend?"0px":this.cellWidth+"px","max-width":e.weekend?"0px":this.cellWidth+"px"}},entityLineStyle:function(e){return{"background-color":e.color}},timebarStyle:function(e){return{left:this.getTimebarLeft(e)+"px",width:this.getTimebarWidth(e)+"px",cursor:this.isCurrentUserAdmin?"ew-resize":"default"}},getTimebarLeft:function(e){var t=e.startDate||this.startDate,s=this.businessDiff(this.startDate,t)||0;return s*this.cellWidth+5},getTimebarWidth:function(e){var t=e.startDate||this.startDate,s=e.endDate||e.startDate&&e.startDate.clone().add(1,"days")||this.startDate.clone().add(1,"days"),i=this.businessDiff(t,s)||1;return(i+1)*this.cellWidth-10}}),socket:{},watch:{startDate:function(){this.resetScheduleSize()},endDate:function(){this.resetScheduleSize()},zoomLevel:function(){this.resetScheduleSize()},isLoading:function(){this.$nextTick(this.resetScheduleSize)}}},k=S,M=(s("d1db"),Object(p["a"])(k,w,C,!1,null,"b63c69b0",null)),E=M.exports,x={name:"production-schedule",components:{ComboboxNumber:v,Datepicker:c["a"],Schedule:E,TaskInfo:b["a"],TextField:g["a"]},data:function(){return{currentTask:null,overallManDays:0,endDate:o()().add(6,"months"),scheduleItems:[],startDate:o()(),selectedStartDate:null,selectedEndDate:null,zoomLevel:3,zoomOptions:[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted:function(){this.reset()},computed:Object(a["a"])({},Object(r["c"])(["currentEpisode","currentProduction","isCurrentUserAdmin","taskTypeMap","user"]),{locale:function(){return"fr_FR"===this.user.locale?d["fr"]:d["en"]}}),methods:Object(a["a"])({},Object(r["b"])(["editProduction","loadScheduleItems","saveScheduleItem"]),{loadData:function(){var e=this;this.loading.schedule=!0,this.loadScheduleItems(this.currentProduction).then(function(t){t=t.map(function(t){var s=e.taskTypeMap[t.task_type_id];return Object(a["a"])({},t,{color:s.color,for_shots:s.for_shots,name:s.name,priority:s.priority,startDate:o()(t.start_date,"YYYY-MM-DD"),endDate:o()(t.end_date,"YYYY-MM-DD")})}),e.scheduleItems=Object(u["h"])(t,e.taskTypeMap),e.loading.schedule=!1}).catch(function(t){console.error(t),e.loading.schedule=!1})},changeZoom:function(e){e.wheelDelta<0&&this.zoomLevel>1&&this.zoomLevel--,e.wheelDelta>0&&this.zoomLevel<3&&this.zoomLevel++},reset:function(){this.currentProduction.start_date&&(this.startDate=o()(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=o()(this.currentProduction.end_date)),this.overallManDays=this.currentProduction.man_days,this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),this.loadData()}}),socket:{},watch:{selectedStartDate:function(){this.startDate=o()(this.selectedStartDate),this.editProduction({data:Object(a["a"])({},this.currentProduction,{start_date:this.startDate.format("YYYY-MM-DD")})})},selectedEndDate:function(){this.endDate=o()(this.selectedEndDate),this.editProduction({data:Object(a["a"])({},this.currentProduction,{end_date:this.endDate.format("YYYY-MM-DD")})})},overallManDays:function(){this.overallManDays!==this.currentProduction.man_days&&this.editProduction({data:Object(a["a"])({},this.currentProduction,{man_days:this.overallManDays})})},currentProduction:function(){this.reset()}},metaInfo:function(){return this.isTVShow?{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" - ".concat(this.currentEpisode?this.currentEpisode.name:"")+" | ".concat(this.$t("schedule.title")," - Kitsu")}:{title:"".concat(this.currentProduction.name," ")+"| ".concat(this.$t("schedule.title")," - Kitsu")}}},Y=x,L=(s("44f6"),Object(p["a"])(Y,i,n,!1,null,"b1cde27c",null));t["default"]=L.exports},d1db:function(e,t,s){"use strict";var i=s("62da"),n=s.n(i);n.a},dd1c:function(e,t,s){},e007:function(e,t,s){"use strict";var i=s("dd1c"),n=s.n(i);n.a}}]);
//# sourceMappingURL=chunk-42029546.d5d82e46.js.map