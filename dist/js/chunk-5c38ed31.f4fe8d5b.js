(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c38ed31"],{"0498":function(t,e,i){"use strict";var s=i("a011"),n=i.n(s);n.a},"23ef":function(t,e,i){"use strict";var s=i("53aa"),n=i.n(s);n.a},2431:function(t,e,i){"use strict";var s=i("41d2"),n=i.n(s);n.a},"41d2":function(t,e,i){},"53aa":function(t,e,i){},"7c2a":function(t,e,i){"use strict";var s=i("d5fa"),n=i.n(s);n.a},"9fbb":function(t,e,i){},a011:function(t,e,i){},d1e3:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"productions page fixed-page"},[i("div",{staticClass:"columns"},[i("div",{staticClass:"playlist-list-column column"},[t.isCurrentUserManager?i("button",{key:"new-playlist-button",class:{button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.addPlaylist}},[i("plus-icon",{staticClass:"icon is-small"}),t._v("\n        "+t._s(t.$t("playlists.new_playlist"))+"\n      ")],1):t._e(),t.loading.playlists?i("spinner",{staticClass:"mt2"}):i("div",{staticClass:"playlists"},t._l(t.playlists,(function(e){return i("router-link",{key:e.id,class:{"playlist-item":!0,selected:e.id===t.currentPlaylist.id},attrs:{to:t.getPlaylistPath(e.id)}},[i("span",[t._v("\n          "+t._s(e.name)+"\n          ")]),i("span",{staticClass:"playlist-date"},[t._v("\n          "+t._s(t.formatDate(e.created_at))+"\n          ")])])})),1),t.errors.playlistLoading?i("error-text",{attrs:{text:"$t('playlists.loading_error')"}}):t._e()],1),i("div",{staticClass:"playlist-column column"},[i("playlist-player",{ref:"playlist-player",attrs:{playlist:t.currentPlaylist,shots:t.currentShots,"is-loading":t.loading.playlist},on:{"preview-changed":t.onPreviewChanged,"playlist-deleted":t.goFirstPlaylist,"remove-shot":t.removeShot,"order-change":t.onOrderChange,annotationchanged:t.onAnnotationChanged}})],1),t.isCurrentUserManager?i("div",{staticClass:"addition-column column"},[t.isShotsLoading?i("spinner",{key:"shot-loader",staticClass:"mt2"}):i("div",[i("div",{staticClass:"addition-header"},[i("page-subtitle",{attrs:{text:t.$t("playlists.add_shots")}}),i("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addWeekly},attrs:{disabled:t.isAdditionLoading},on:{click:t.addAllPending}},[t._v("\n            "+t._s(t.$t("playlists.build_weekly"))+"\n          ")]),i("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addDaily},attrs:{disabled:t.isAdditionLoading},on:{click:t.addDailyPending}},[t._v("\n            "+t._s(t.$t("playlists.build_daily"))+"\n          ")]),t.episodes.length>0||!t.isTVShow?i("div",{key:"shot-list-header",staticClass:"mt1"},[i("div",[t.sequenceOptions.length>0?i("combobox",{staticClass:"select-sequence-combobox",attrs:{label:t.$t("shots.fields.sequence"),options:t.sequenceOptions},model:{value:t.sequenceId,callback:function(e){t.sequenceId=e},expression:"sequenceId"}}):t._e(),0===t.sequenceOptions.length?i("div",[t._v("\n                "+t._s(t.$t("playlists.no_sequence_for_episode"))+"\n              ")]):t._e(),t.sequenceOptions.length>0?i("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addSequence},attrs:{disabled:t.isAdditionLoading},on:{click:t.addSequence}},[t._v("\n                "+t._s(t.$t("playlists.add_sequence"))+"\n              ")]):t._e()],1)]):i("div",[t._v("\n            "+t._s(t.$t("playlists.no_shot_for_production"))+"\n          ")]),0===t.sequenceShots.length&&t.sequenceId?i("div",[t._v("\n            "+t._s(t.$t("playlists.no_shot_for_sequence"))+"\n          ")]):t._e()],1),t._l(t.sequenceShots,(function(e){return i("div",{key:e.id,class:{"addition-shot":!0,playlisted:void 0!==t.currentShots[e.id]},on:{click:function(i){return i.preventDefault(),t.addShotToPlaylist(e)}}},[i("entity-thumbnail",{attrs:{entity:e,"empty-width":150,"empty-height":100}}),t._v("\n          "+t._s(e.name)+"\n        ")],1)}))],2)],1):t._e()])])},n=[],a=(i("8e6e"),i("456d"),i("75fc")),r=(i("8615"),i("ac6a"),i("7f7f"),i("bd86")),o=i("7f45"),l=i.n(o),c=i("2f62"),h=i("0a35"),d=i("3657"),u=i("66e7"),p=i("992f"),f=i("bb21"),y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{class:{error:!0,"has-text-right":t.alignRight,"is-hidden":t.hidden}},[t._v("\n  "+t._s(t.text)+"\n")])},m=[],v={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}},g=v,b=i("2877"),P=Object(b["a"])(g,y,m,!1,null,null,null),w=P.exports,C=i("8751"),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"playlist-player dark"},[i("div",{ref:"header",staticClass:"playlist-header flexrow"},[i("span",{staticClass:"flexrow-item playlist-name"},[t._v("\n      "+t._s(t.playlist.name)+"\n    ")]),i("button-simple",{staticClass:"edit-button playlist-button flexrow-item",attrs:{icon:"edit"},on:{click:t.showEditModal}}),i("button-simple",{staticClass:"delete-button playlist-button flexrow-item",attrs:{icon:"delete"},on:{click:t.showDeleteModal}})],1),i("div",{ref:"video-container",staticClass:"filler flexrow video-container"},[i("raw-video-player",{ref:"raw-player",staticClass:"raw-player",attrs:{shots:t.shotList},on:{"shot-change":t.onShotChange,"time-update":t.onTimeUpdate,"max-duration-update":t.onMaxDurationUpdate}}),t.isComparing?i("raw-video-player",{ref:"raw-player-comparison",staticClass:"raw-player",attrs:{shots:t.shotListToCompare}}):t._e(),i("div",{ref:"canvas-wrapper",staticClass:"canvas-wrapper"},[i("canvas",{ref:"annotation-canvas",staticClass:"canvas",attrs:{id:"annotation-canvas"}})]),i("task-info",{ref:"task-info",class:{"flexrow-item":!0,"task-info-column":!0,hidden:t.isCommentsHidden},attrs:{task:t.task,"is-preview":!1}})],1),i("div",{ref:"progress-cursor",staticClass:"progress-cursor"}),i("div",{ref:"playlist-progress",staticClass:"playlist-progress"},[i("div",{staticClass:"video-progress"},[i("progress",{ref:"progress",attrs:{value:"0",min:"0"},on:{click:t.onProgressBarClicked}},[i("span",{ref:"progress-bar",attrs:{id:"progress-bar"}})])])]),t.playlist.id?i("annotation-bar",{ref:"playlist-annotation",staticClass:"playlist-annotations",attrs:{annotations:t.annotations,"max-duration-raw":t.maxDurationRaw},on:{"select-annotation":t.loadAnnotation}}):t._e(),t.playlist.id?i("div",{ref:"button-bar",staticClass:"playlist-footer flexrow"},[t.isPlaying?i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"pause"},on:{click:t.onPlayClicked}}):i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"play"},on:{click:t.onPlayClicked}}),i("span",{staticClass:"flexrow-item time-indicator"},[t._v("\n      "+t._s(t.currentTime)+"\n    ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v("\n    /\n    ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v("\n      "+t._s(t.maxDuration)+"\n    ")]),i("span",{staticClass:"flexrow-item time-indicator mr1"},[t._v("\n      ("+t._s(t.currentFrame)+")\n    ")]),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"left"},on:{click:t.onPreviousFrameClicked}}),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"right"},on:{click:t.onNextFrameClicked}}),i("span",{staticClass:"flexrow-item time-indicator"},[t._v("\n      "+t._s(t.shotList.length>0?t.playingShotIndex+1:0)+"\n    ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v("\n    /\n    ")]),i("span",{staticClass:"flexrow-item time-indicator mr1"},[t._v("\n      "+t._s(t.shotList.length)+"\n    ")]),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"back"},on:{click:t.onPlayPreviousShotClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"forward"},on:{click:t.onPlayNextShotClicked}}),t.taskTypeOptions?i("button-simple",{class:{"comparison-button":!0,"flexrow-item":!0,"playlist-button":!0,active:t.isComparing},attrs:{icon:"compare"},on:{click:t.onCompareClicked}}):t._e(),t.isComparing?i("combobox",{staticClass:"playlist-button flexrow-item comparison-list",attrs:{options:t.taskTypeOptions},model:{value:t.taskTypeToCompare,callback:function(e){t.taskTypeToCompare=e},expression:"taskTypeToCompare"}}):t._e(),i("span",{staticClass:"filler"}),i("button-simple",{class:{"playlist-button":!0,"flexrow-item":!0,active:t.isDrawing},attrs:{icon:"pencil"},on:{click:t.onAnnotateClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"remove"},on:{click:t.onDeleteClicked}}),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"comment"},on:{click:t.onCommentClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"film"},on:{click:t.onFilmClicked}}),i("div",{staticClass:"flexrow-item playlist-button",staticStyle:{position:"relative"}},[i("a",{class:{"dl-button":!0,"zip-button":!0,hidden:t.isDlButtonsHidden},attrs:{href:t.zipDlPath}},[t._v("\n        "+t._s(t.$t("playlists.download_zip"))+"\n      ")]),i("span",{class:{"dl-button":!0,"mp4-button":!0,hidden:t.isDlButtonsHidden},on:{click:t.onBuildClicked}},[t._v("\n        "+t._s(t.$t("playlists.build_mp4"))+"\n      ")]),i("div",{class:{"build-list":!0,hidden:t.isDlButtonsHidden}},[t.playlist.build_jobs&&0!==t.playlist.build_jobs.length?i("div",[i("div",{staticClass:"build-title"},[t._v("\n            "+t._s(t.$t("playlists.available_build"))+"\n          ")]),t._l(t.playlist.build_jobs,(function(e){return i("div",{key:e.id,staticClass:"flexrow"},[i("a",{staticClass:"flexrow-item",attrs:{href:t.getBuildPath(e)}},[t._v("\n              "+t._s(t.formatDate(e.created_at))+"\n            ")]),i("span",{staticClass:"filler"}),"running"===e.status?i("spinner",{staticClass:"build-spinner"}):i("button",{staticClass:"delete-job-button",on:{click:function(i){return t.onRemoveBuildJob(e)}}},[t._v("\n              x\n            ")])],1)}))],2):i("span",[t._v("\n        "+t._s(t.$t("playlists.no_build"))+"\n        ")])]),i("button-simple",{staticClass:"playlist-button",attrs:{icon:"download"},on:{click:t.toggleDlButtons}})],1),t.isFullScreenEnabled?i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"maximize"},on:{click:t.onFullscreenClicked}}):t._e()],1):t._e(),t.playlist.id?i("div",{ref:"playlisted-shots",class:{"playlisted-shots":!0,flexrow:!0,hidden:t.isShotsHidden}},[t.isLoading?i("spinner",{staticClass:"spinner"}):t._l(t.shotList,(function(e,s){return i("div",{key:e.id,staticClass:"flexrow-item has-text-centered"},[i("playlisted-shot",{ref:"shot-"+s,refInFor:!0,attrs:{index:s,shot:e,"is-playing":t.playingShotIndex===s},on:{"play-click":t.playShot,"remove-shot":t.removeShot,"preview-changed":t.onPreviewChanged,"shot-dropped":t.onShotDropped}})],1)}))],2):t._e(),i("edit-playlist-modal",{attrs:{active:t.modals.edit,"is-loading":t.loading.editPlaylist,"is-error":t.errors.editError,"playlist-to-edit":t.playlist},on:{cancel:t.hideEditModal,confirm:t.confirmEditPlaylist}}),i("delete-modal",{attrs:{active:t.modals.delete,"is-loading":t.loading.deletePlaylist,"is-error":t.errors.deletePlaylist,text:t.deleteText,"error-text":t.$t("playlists.delete_error")},on:{confirm:t.confirmRemovePlaylist,cancel:t.hideDeleteModal}})],1)},x=[],k=(i("7514"),i("6762"),i("2fdb"),i("20d6"),i("f576"),i("7a94")),S=i("bcd2"),T=i("8707"),$=i("de40"),O=i("5f48"),D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{modal:!0,"is-active":t.active}},[i("div",{staticClass:"modal-background"}),i("div",{staticClass:"modal-content"},[i("div",{staticClass:"box"},[t.playlistToEdit&&t.playlistToEdit.id?i("h1",{staticClass:"title"},[t._v("\n        "+t._s(t.$t("playlists.edit_title"))+" "+t._s(t.playlistToEdit.name)+"\n      ")]):i("h1",{staticClass:"title"},[t._v("\n        "+t._s(t.$t("playlists.no_playlist"))+"\n      ")]),i("form",{on:{submit:function(t){t.preventDefault()}}},[i("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("playlists.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("p",{staticClass:"has-text-right"},[i("a",{class:{button:!0,"is-primary":!0,"is-loading":t.isLoading},on:{click:t.runConfirmation}},[t._v("\n          "+t._s(t.$t("main.confirmation"))+"\n        ")]),i("button",{staticClass:"button is-link",on:{click:function(e){return t.$emit("cancel")}}},[t._v("\n          "+t._s(t.$t("main.cancel"))+"\n        ")])]),t.isError?i("p",{staticClass:"error has-text-right info-message"},[t._v("\n        "+t._s(t.$t("assets.edit_fail"))+"\n      ")]):t._e()])])])},j=[],E=i("7bf8"),F=i("d065"),I={name:"edit-playlist-modal",mixins:[F["a"]],components:{TextField:E["a"]},props:["active","cancelRoute","isLoading","isError","playlistToEdit"],watch:{playlistToEdit:function(){this.playlistToEdit&&this.playlistToEdit.id?this.form.name=this.playlistToEdit.name:this.form={name:""}},active:function(){var t=this;this.active&&setTimeout((function(){t.$refs.nameField.focus()}),100)}},data:function(){return this.playlistToEdit&&this.playlistToEdit.id?{form:{name:this.playlistToEdit.name}}:{form:{name:""}}},methods:{runConfirmation:function(){this.$emit("confirm",this.form)}}},L=I,M=(i("2431"),Object(b["a"])(L,D,j,!1,null,"7645d689",null)),q=M.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flexrow wrapper"},[i("drag",{attrs:{"transfer-data":t.shot.id},on:{drag:t.onDragged}},[i("div",{class:{"playlisted-shot":!0,playing:t.isPlaying}},[i("div",{staticClass:"thumbnail-wrapper",on:{click:function(e){return e.preventDefault(),t.onPlayClick(e)}}},[t.isCurrentUserManager?i("span",{staticClass:"remove-button flexrow-item",attrs:{title:t.$t("playlists.remove")},on:{click:function(e){return e.preventDefault(),t.onRemoveClick(e)}}},[i("x-icon")],1):t._e(),i("entity-thumbnail",{staticClass:"shot-thumbnail",attrs:{"empty-width":150,"empty-height":103,entity:t.shot,"preview-file-id":t.previewFileId}})],1),i("div",{staticClass:"shot-title"},[t._v(t._s(t.shot.sequence_name)+" / "+t._s(t.shot.name))]),t.taskTypeOptions.length>0?i("div",{staticClass:"preview-choice"},[i("combobox",{attrs:{options:t.taskTypeOptions,disabled:!t.isCurrentUserManager},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}}),i("combobox",{staticClass:"version-combo",attrs:{options:t.previewFileOptions,disabled:!t.isCurrentUserManager},model:{value:t.previewFileId,callback:function(e){t.previewFileId=e},expression:"previewFileId"}})],1):i("div",[t._v("\n        "+t._s(t.$t("playlists.no_preview"))+"\n      ")])])]),i("drop",{on:{drop:t.onDropped}},[i("div",{ref:"drop-area",staticClass:"drop-area"})])],1)},B=[],H=(i("55dd"),i("c5f6"),i("ceca")),R=i.n(H);function N(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function z(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?N(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):N(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var W={name:"playlisted-shot",components:{Combobox:p["a"],EntityThumbnail:f["a"],XIcon:h["I"]},data:function(){return{taskTypeId:null,previewFileId:this.shot.preview_file_id}},props:{index:{default:0,type:Number},isPlaying:{default:!1,type:Boolean},shot:{default:function(){},type:Object}},mounted:function(){this.setCurrentParameters(),this.setListeners()},computed:z({},Object(c["c"])(["taskTypeMap","isCurrentUserManager"]),{dropArea:function(){return this.$refs["drop-area"]},taskTypeOptions:function(){var t=this;return Object.keys(this.shot.preview_files).map((function(e){return t.taskTypeMap[e]})).sort(R()("priority",1).thenBy("name")).map((function(t){return{label:t.name,value:t.id}}))},previewFileOptions:function(){var t=this.shot.preview_files[this.taskTypeId]||[];return t.map((function(t){return{label:"v".concat(t.revision),value:t.id}}))}}),methods:{getTaskTypeIdForPreviewFile:function(t,e){var i=this;return t.find((function(t){var s=i.shot.preview_files[t];return s.some((function(t){return t.id===e}))}))},setCurrentParameters:function(){var t=Object.keys(this.shot.preview_files);t.length>0&&(this.shot.preview_file_id&&(this.taskTypeId=this.getTaskTypeIdForPreviewFile(t,this.shot.preview_file_id)),this.taskTypeId||(this.taskTypeId=t[0]))},setListeners:function(){this.dropArea.addEventListener("dragover",this.onDragover),this.dropArea.addEventListener("dragleave",this.onDragleave)},onDragged:function(){},onDragleave:function(){this.dropArea.style.background="transparent"},onDragover:function(){this.dropArea.style.background="#00B242"},onDropped:function(t){this.$refs["drop-area"].style.background="transparent",this.$emit("shot-dropped",{before:this.shot.id,after:t})},onPlayClick:function(){this.$emit("play-click",this.index)},onRemoveClick:function(t){t.preventDefault(),t.stopPropagation(),this.$emit("remove-shot",this.shot)}},watch:{taskTypeId:function(){var t=this,e=this.shot.preview_files[this.taskTypeId];if(e&&e.length>0){var i=e.some((function(e){return e.id===t.shot.preview_file_id}));this.previewFileId=i?this.shot.preview_file_id:e[0].id}},previewFileId:function(){this.$emit("preview-changed",this.shot,this.previewFileId)}}},U=W,Y=(i("23ef"),Object(b["a"])(U,A,B,!1,null,"077b9baa",null)),J=Y.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"video-wrapper filler flexrow-item"},[i("video",{ref:"player1",attrs:{preload:"auto"},on:{ended:t.playNext}}),i("video",{ref:"player2",attrs:{preload:"auto"},on:{ended:t.playNext}})])},K=[];function X(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function G(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?X(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):X(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Q={name:"raw-video-player",components:{},props:{shots:{type:Array,default:function(){return[]}}},data:function(){return{currentPlayer:this.player1,isPlaying:!1,nextPlayer:this.player2,playingIndex:0}},mounted:function(){this.resetHeight(),window.addEventListener("resize",this.resetHeight)},beforeDestroy:function(){window.removeEventListener("resize",this.resetHeight)},computed:G({},Object(c["c"])(["currentProduction"]),{container:function(){return this.$refs.container},fps:function(){return this.currentProduction.fps||24},player1:function(){return this.$refs.player1},player2:function(){return this.$refs.player2}}),methods:{getMoviePath:function(t){return"/api/movies/originals/preview-files/".concat(t,".mp4")},getNextIndex:function(t){var e=t+1>=this.shots.length?0:t+1;while(e!==t&&"mp4"!==this.shots[e].preview_file_extension)e++,e>=this.shots.length&&(e=0);return e},getPreviousIndex:function(t){var e=t-1>=0?t-1:this.shots.length-1;while(e!==t&&"mp4"!==this.shots[e].preview_file_extension)e--,e<0&&(e=this.shots.length);return e},clear:function(){this.currentPlayer&&(this.currentPlayer.src="",this.currentPlayer.removeAttribute("src"),this.currentPlayer.load())},goPreviousFrame:function(){var t=this.currentPlayer.currentTime-1/this.fps;t<0?this.setCurrentTime(0):this.setCurrentTime(t)},goNextFrame:function(){var t=this.currentPlayer.currentTime+1/this.fps;t>this.currentPlayer.duration?this.setCurrentTime(this.video.duration):this.setCurrentTime(t)},loadPreviousShot:function(){this.loadShot(this.getPreviousIndex(this.currentIndex)),this.$emit("shot-change",this.currentIndex)},loadNextShot:function(){this.loadShot(this.getNextIndex(this.currentIndex)),this.$emit("shot-change",this.currentIndex)},loadShot:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<this.shots.length){var e=this.getNextIndex(t),i=this.shots[t],s=this.shots[e];this.currentIndex=t,this.currentPlayer=this.player1,this.nextPlayer=this.player2,this.currentPlayer.removeEventListener("loadedmetadata",this.updateMaxDuration),this.currentPlayer.addEventListener("loadedmetadata",this.updateMaxDuration),this.currentPlayer.src=this.getMoviePath(i.preview_file_id),this.nextPlayer.src=this.getMoviePath(s.preview_file_id),this.currentPlayer.style.display="block",this.nextPlayer.style.display="none",this.resetHeight(),this.currentPlayer.removeEventListener("timeupdate",this.updateTime),this.currentPlayer.addEventListener("timeupdate",this.updateTime),this.$emit("shot-change",this.currentIndex)}},pause:function(){this.currentPlayer&&this.currentPlayer.pause(),this.isPlaying=!1},play:function(){var t=this.shots[this.currentIndex];t&&(t.preview_file_id||this.loadNextShot(),t=this.shots[this.currentIndex],t.preview_file_id&&(this.currentPlayer&&this.currentPlayer.play(),this.isPlaying=!0))},playNext:function(){var t=this.getNextIndex(this.currentIndex);this.currentIndex=t,this.$emit("shot-change",this.currentIndex),this.currentPlayer.style.display="none",this.nextPlayer.style.display="block",this.nextPlayer.play(),this.switchPlayers(),this.updateMaxDuration()},resetHeight:function(){var t=this;this.$nextTick((function(){t.currentPlayer&&(t.currentPlayer.style.height="0px"),t.nextPlayer&&(t.nextPlayer.style.height="0px");var e=t.container.offsetHeight;t.currentPlayer&&(t.currentPlayer.style.height="".concat(e,"px")),t.nextPlayer&&(t.nextPlayer.style.height="".concat(e,"px"))}))},getCurrentTime:function(){return this.currentPlayer.currentTime},setCurrentTime:function(t){t=Object(S["a"])(t,this.fps),this.currentPlayer&&(this.currentPlayer.currentTime=t)},switchPlayers:function(){var t=this.getNextIndex(this.currentIndex),e=this.shots[t];this.tmpPlayer=this.currentPlayer,this.currentPlayer=this.nextPlayer,this.nextPlayer=this.tmpPlayer,this.nextPlayer.src=this.getMoviePath(e.preview_file_id),this.resetHeight(),this.currentPlayer.removeEventListener("timeupdate",this.updateTime),this.nextPlayer.removeEventListener("timeupdate",this.updateTime),this.currentPlayer.addEventListener("timeupdate",this.updateTime)},updateTime:function(t){this.$emit("time-update",t)},updateMaxDuration:function(){this.$emit("max-duration-update",this.currentPlayer.duration)}},watch:{shots:function(){if(this.shots.length>0){this.loadShot(0),this.pause(),this.setCurrentTime(0);var t=this.shots[this.currentIndex];t&&!t.preview_file_id&&this.loadNextShot()}setTimeout(this.resetHeight,300)}}},Z=Q,tt=(i("f3e6"),Object(b["a"])(Z,V,K,!1,null,"fc2c9bcc",null)),et=tt.exports,it=i("be83"),st=i("9d94"),nt=i("9fbc");function at(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function rt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?at(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):at(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ot={name:"playlist-player",mixins:[nt["a"]],components:{AnnotationBar:T["a"],ButtonSimple:$["a"],Combobox:p["a"],DeleteModal:O["a"],EditPlaylistModal:q,PlaylistedShot:J,RawVideoPlayer:et,Spinner:it["a"],TaskInfo:st["a"]},props:{playlist:{type:Object,default:function(){}},shots:{type:Object,default:function(){}},isLoading:{type:Boolean,default:!1}},data:function(){return{annotations:[],currentTime:"00:00.00",currentTimeRaw:0,fabricCanvas:null,isDlButtonsHidden:!0,isCommentsHidden:!0,isComparing:!1,isDrawing:!1,isPlaying:!1,isShotsHidden:!1,maxDuration:"00:00.00",maxDurationRaw:0,playingShotIndex:0,shotList:[],shotListToCompare:[],task:null,taskTypeOptions:[],taskTypeToCompare:null,modals:{edit:!1,delete:!1},loading:{playlists:!1,editPlaylist:!1,deletePlaylist:!1},errors:{playlists:!1,editPlaylist:!1,deletePlaylist:!1}}},mounted:function(){var t=this;this.shotList=Object.values(this.shots),this.updateProgressBar(),this.$nextTick((function(){window.addEventListener("keydown",t.onKeyDown,!1),window.addEventListener("resize",t.onWindowResize),t.$el.onmousemove=t.onMouseMove,t.setupCanvas()}))},beforeDestroy:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("resize",this.onWindowResize)},computed:rt({},Object(c["c"])(["currentProduction","taskMap","taskTypeMap","user"]),{isFullScreenEnabled:function(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled||document.createElement("video").webkitRequestFullScreen)},zipDlPath:function(){return"/api/data/playlists/".concat(this.playlist.id,"/download/zip")},canvas:function(){return this.$refs["canvas-wrapper"]},container:function(){return this.$refs.container},currentFrame:function(){return"".concat(Math.floor(this.currentTimeRaw*this.fps)).padStart(3,"0")},fps:function(){return this.currentProduction.fps||24},rawPlayer:function(){return this.$refs["raw-player"]},rawPlayerComparison:function(){return this.$refs["raw-player-comparison"]},progress:function(){return this.$refs.progress},progressBar:function(){return this.$refs["progress-bar"]},progressCursor:function(){return this.$refs["progress-cursor"]},video:function(){return this.$refs.movie},deleteText:function(){return this.playlist?this.$t("playlists.delete_text",{name:this.playlist.name}):""},timezone:function(){return this.user.timezone||l.a.tz.guess()}}),methods:rt({},Object(c["b"])(["deletePlaylist","editPlaylist","removeBuildJob","runPlaylistBuild"]),{getBuildPath:function(t){return"/api/data/playlists/".concat(this.playlist.id,"/jobs/").concat(t.id,"/build/mp4")},formatDate:function(t){var e=l.a.tz(t,"UTC").tz(this.timezone);return e.format("YYYY-MM-DD HH:mm")},formatTime:function(t){var e=".".concat(Math.round(t%1*100));2===e.length&&(e+="0");try{return new Date(1e3*t).toISOString().substr(14,5)+e}catch(i){return console.log(i),"00:00.00"}},getTimelinePosition:function(t,e){if(this.$refs.movie){var i=Math.round(t/this.$refs.movie.duration*this.progress.offsetWidth);return i=i-10*e-5,i<0&&(i=0),i+10>this.progress.offsetWidth&&(i-=5),i}return 0},displayBars:function(){this.$refs["header"].style.display="flex",this.$refs["button-bar"].style.display="flex",this.$refs["playlist-progress"].style.display="flex",this.$refs["header"].style.opacity=1,this.$refs["button-bar"].style.opacity=1,this.$refs["playlist-progress"].style.opacity=1,this.$refs["container"].style.cursor="default"},hideBars:function(){var t=this;this.$refs["header"].style.opacity=0,this.$refs["button-bar"].style.opacity=0,this.$refs["playlist-progress"].style.opacity=0,setTimeout((function(){t.$refs["header"].style.display="none",t.$refs["button-bar"].style.display="none",t.$refs["playlist-progress"].style.display="none",t.$refs["container"].style.cursor="none"}),500)},showEditModal:function(){this.modals.edit=!0},hideEditModal:function(){this.modals.edit=!1},showDeleteModal:function(){this.modals.delete=!0},hideDeleteModal:function(){this.modals.delete=!1},confirmRemovePlaylist:function(){var t=this;this.loading.deletePlaylist=!0,this.errors.deletePlaylist=!1,this.deletePlaylist({playlist:this.playlist,callback:function(e){e&&(t.errors.deletePlaylist=!0),t.loading.deletePlaylist=!1,t.$emit("playlist-deleted"),t.modals.delete=!1}})},confirmEditPlaylist:function(t){var e=this;this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{name:t.name,id:this.playlist.id},callback:function(i){i&&(e.errors.editPlaylist=!0),e.loading.editPlaylist=!1,e.modals.edit=!1,e.playlist.name=t.name}})},updateProgressBar:function(){var t=this.currentTimeRaw/this.maxDurationRaw;this.progress.value=this.currentTimeRaw,this.progressBar.style.width=Math.floor(100*t)+"%";var e=this.progress.getBoundingClientRect(),i=e.width*t+e.x;this.progressCursor.style.left=Math.round(i-7)+"px",this.progressCursor.style.top=Math.round(e.y-3)+"px"},updateTaskPanel:function(){if(this.shotList.length>0){var t=this.shotList[this.playingShotIndex];this.task=t?this.taskMap[t.preview_file_task_id]:null}else this.task=null},scrollToShot:function(t){var e=this.$refs["shot-"+t];if(e&&e[0]){var i=e[0].$el,s=this.$refs["playlisted-shots"],n=this.shotList[t];if(this.annotations=n.preview_file_annotations||[],i){var a=30,r=i.getBoundingClientRect(),o=s.getBoundingClientRect(),l=r.right>o.right-a,c=r.left<o.left-a;if(c){var h=r.left-o.left-a;s.scrollLeft=s.scrollLeft+h}else if(l){var d=r.right-o.right+a;s.scrollLeft=s.scrollLeft+d}}}},scrollToRight:function(){this.shotList.length>0&&this.scrollToShot(this.shotList.length-1)},play:function(){this.rawPlayer.play(),this.isComparing&&this.$refs["raw-player-comparison"].play(),this.isPlaying=this.$refs["raw-player"].isPlaying,this.hideCanvas(),this.clearCanvas()},pause:function(){this.showCanvas(),this.rawPlayer.pause(),this.isComparing&&this.$refs["raw-player-comparison"].pause(),this.isPlaying=!1},playShot:function(t){var e=this.shotList[t];this.hideCanvas(),this.clearCanvas(),"mp4"===e.preview_file_extension?(this.annotations=e.preview_file_annotations||[],this.playingShotIndex=t,this.scrollToShot(this.playingShotIndex),this.rawPlayer.loadShot(t),this.isComparing&&this.$refs["raw-player-comparison"].loadShot(t),this.isPlaying&&(this.rawPlayer.play(),this.isComparing&&this.$refs["raw-player-comparison"].play())):this.annotations=[]},goPreviousFrame:function(){this.clearCanvas(),this.rawPlayer.goPreviousFrame(),this.isComparing&&this.$refs["raw-player-comparison"].goPreviousFrame();var t=this.getAnnotation(this.rawPlayer.getCurrentTime());t&&this.loadAnnotation(t)},goNextFrame:function(){this.clearCanvas(),this.rawPlayer.goNextFrame(),this.isComparing&&this.$refs["raw-player-comparison"].goNextFrame();var t=this.getAnnotation(this.rawPlayer.getCurrentTime());t&&this.loadAnnotation(t)},removeShot:function(t){var e=this;this.$emit("remove-shot",t),this.$options.silent=!0;var i=this.shotList.findIndex((function(e){return e.id===t.id}));this.shotList.splice(i,1),setTimeout((function(){e.$options.silent=!1}),1e3)},setFullScreen:function(){this.container.requestFullscreen?this.container.requestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullScreen?this.container.webkitRequestFullScreen():this.container.msRequestFullscreen&&this.container.msRequestFullscreen(),this.container.setAttribute("data-fullscreen",!0)},exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.container.setAttribute("data-fullscreen",!1)},isFullScreen:function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},onProgressBarClicked:function(t){this.clearCanvas();var e=(t.pageX-this.progress.offsetLeft)/this.progress.offsetWidth,i=e*this.maxDurationRaw;this.rawPlayer.setCurrentTime(i),this.isComparing&&this.$refs["raw-player-comparison"].setCurrentTime(i)},onPreviousFrameClicked:function(){this.goPreviousFrame()},onNextFrameClicked:function(){this.goNextFrame()},onPlayPreviousShotClicked:function(){this.rawPlayer.loadPreviousShot(),this.isComparing&&this.$refs["raw-player-comparison"].loadPreviousShot(),this.isPlaying&&this.play()},onPlayNextShotClicked:function(){this.rawPlayer.loadNextShot(),this.isComparing&&this.$refs["raw-player-comparison"].loadNextShot(),this.isPlaying&&this.play()},onPlayPauseClicked:function(){this.isPlaying?this.pause():this.play()},onFullscreenClicked:function(){this.isFullScreen()?this.exitFullScreen():this.setFullScreen()},onKeyDown:function(t){this.displayBars(),["INPUT","TEXTAREA"].includes(t.target.tagName)||(46===t.keyCode&&this.fabricCanvas?this.deleteSelection():37===t.keyCode?(t.preventDefault(),t.stopPropagation(),this.goPreviousFrame()):39===t.keyCode?(t.preventDefault(),t.stopPropagation(),this.goNextFrame()):32===t.keyCode&&(t.preventDefault(),t.stopPropagation(),this.onPlayPauseClicked()))},onWindowResize:function(){var t=(new Date).getTime();this.lastCall=this.lastCall||0,t-this.lastCall>600&&(this.lastCall=t,this.$nextTick(this.resetHeight))},onFilmClicked:function(){var t=this;this.isShotsHidden=!this.isShotsHidden,this.$nextTick((function(){t.resetHeight(),t.scrollToShot(t.playingShotIndex)}))},onCommentClicked:function(){var t=this,e=this.$refs["video-container"].offsetHeight;this.isCommentsHidden=!this.isCommentsHidden,this.isCommentsHidden||(this.$refs["task-info"].$el.style.height="".concat(e,"px")),this.$nextTick((function(){t.$refs["task-info"].focusCommentTextarea(),t.resetHeight()}))},onCompareClicked:function(){this.isComparing=!this.isComparing},onPlayClicked:function(){this.rawPlayer.isPlaying?this.pause():this.play()},onTimeUpdate:function(){this.rawPlayer.currentPlayer?this.currentTimeRaw=this.rawPlayer.currentPlayer.currentTime:this.currentTimeRaw=0,this.currentTime=this.formatTime(this.currentTimeRaw),this.updateProgressBar()},onMaxDurationUpdate:function(t){this.maxDurationRaw=t,this.maxDuration=this.formatTime(t),this.progress.setAttribute("max",this.maxDurationRaw)},onMouseMove:function(){var t=this,e=this.$refs["button-bar"];e&&1!==e.style.opacity&&this.displayBars();var i=this.isFullScreen()&&this.isShotsHidden&&this.isCommentsHidden;i&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){var e=t.isFullScreen()&&t.isShotsHidden&&t.isCommentsHidden;e&&t.hideBars()}),2e3))},onShotChange:function(t){if(this.playingShotIndex=t,this.rawPlayerComparison){var e=this.rawPlayerComparison.playingIndex;e<t?this.rawPlayerComparison.playNext():(this.rawPlayerComparison.setCurrentTime(0),this.rawPlayerComparison.play())}this.$options.silent||this.scrollToShot(this.playingShotIndex)},onPreviewChanged:function(t,e){this.$emit("preview-changed",t,e)},onShotDropped:function(t){this.$emit("order-change",t)},resetHeight:function(){var t=this;this.$nextTick((function(){var e=t.$refs["container"].offsetHeight;e-=t.$refs["header"].offsetHeight,e-=t.$refs["playlist-progress"].offsetHeight,t.$refs["button-bar"]&&(e-=t.$refs["button-bar"].offsetHeight),t.$refs["playlisted-shots"]&&(e-=t.$refs["playlisted-shots"].offsetHeight),t.$refs["playlist-annotation"]&&(e-=t.$refs["playlist-annotation"].$el.offsetHeight),t.$refs["video-container"].style.height="".concat(e,"px"),t.isCommentsHidden||(t.$refs["task-info"].$el.style.height="".concat(e,"px")),t.rawPlayer.resetHeight(),t.isComparing&&t.$refs["raw-player-comparison"].resetHeight(),t.$nextTick((function(){t.resetCanvas(),t.updateProgressBar()}))}))},resetCanvas:function(){this.resetCanvasSize(),this.fabricCanvas.renderAll(),this.clearCanvas();var t=this.getAnnotation(this.currentTimeRaw);t&&this.loadAnnotation(t)},resetCanvasSize:function(){if(this.rawPlayer){var t=this.rawPlayer.$el.offsetWidth,e=this.rawPlayer.$el.offsetHeight;this.fabricCanvas.setDimensions({width:t,height:e})}},rebuildComparisonOptions:function(){var t=this,e=Object.values(this.shots);if(e.length>0){var i=Object.keys(e[0].preview_files);Object.values(this.shots).forEach((function(t){var e=Object.keys(t.preview_files);i=i.filter((function(t){return e.includes(t)}))})),this.taskTypeOptions=i.map((function(e){return{label:t.taskTypeMap[e].name,value:t.taskTypeMap[e].id}})),this.taskTypeOptions.length>0&&(this.taskTypeToCompare=this.taskTypeOptions[0].value)}else this.taskTypeOptions=[]},rebuildShotListToCompare:function(){var t=this;this.taskTypeToCompare?this.shotListToCompare=this.shotList.map((function(e){var i=e.preview_files[t.taskTypeToCompare][0];return{preview_file_id:i.id,preview_file_extension:"mp4"}})):this.buildShotListToCompare=[]},resetComparison:function(){var t=this;this.rebuildShotListToCompare(),this.$nextTick((function(){t.pause();var e=t.$refs["raw-player-comparison"];e.loadShot(t.playingShotIndex),e.setCurrentTime(t.currentTimeRaw)}))},clearCanvas:function(){this.fabricCanvas.clear()},onAnnotateClicked:function(){this.showCanvas(),this.isDrawing?(this.fabricCanvas.isDrawingMode=!1,this.isDrawing=!1):(this.fabricCanvas.isDrawingMode=!0,this.isDrawing=!0)},showCanvas:function(){this.canvas.style.display="block"},hideCanvas:function(){this.canvas.style.display="none"},setupCanvas:function(){var t=this;this.fabricCanvas=new k["fabric"].Canvas("annotation-canvas",{width:400,height:400}),this.fabricCanvas.freeDrawingBrush.color="#ff3860",this.fabricCanvas.freeDrawingBrush.width=4,this.fabricCanvas.on("object:moved",this.saveAnnotations),this.fabricCanvas.on("mouse:up",(function(){t.isDrawing&&t.saveAnnotations()})),this.resetCanvas(),this.fabricCanvas.renderAll()},loadAnnotation:function(t){var e=this;this.pause();var i=t.time||0;this.rawPlayer.setCurrentTime(i),this.isComparing&&this.$refs["raw-player-comparison"].setCurrentTime(i),this.currentTimeRaw=i,this.updateProgressBar(),this.fabricCanvas.isDrawingMode=!1,this.isDrawing=!1,this.clearCanvas();var s=1,n=1;t.width&&(s=this.fabricCanvas.width/t.width,n=this.fabricCanvas.width/t.width),t.height&&(n=this.fabricCanvas.height/t.height),t.drawing.objects.forEach((function(t){var i={left:t.left*s,top:t.top*n,fill:"transparent",stroke:"#ff3860",strokeWidth:4,radius:t.radius,width:t.width,height:t.height,scaleX:t.scaleX*s,scaleY:t.scaleY*n};if("path"===t.type){var a=1;t.canvasWidth&&(a=t.canvasWidth/e.fabricCanvas.width);var r=new k["fabric"].Path(t.path,rt({},i,{strokeWidth:3*a,canvasWidth:t.canvasWidth}));r.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1}),e.fabricCanvas.add(r)}}))},saveAnnotations:function(){var t=Object(S["a"])(this.currentTimeRaw,this.fps)||0;if(this.annotations){var e=this.getAnnotation(t),i=this.getNewAnnotations(t,e),s=this.shotList[this.playingShotIndex],n={id:s.preview_file_id,task_id:s.preview_file_task_id,annotations:s.preview_file_annotations};this.$emit("annotationchanged",{preview:n,annotations:i})}},onDeleteClicked:function(){this.deleteSelection()},deleteSelection:function(){this.fabricCanvas.remove(this.fabricCanvas.getActiveObject()),this.saveAnnotations()},getAnnotation:function(t){return t=Object(S["a"])(t,this.fps),this.annotations?this.annotations.find((function(e){return e.time===t})):null},toggleDlButtons:function(){this.isDlButtonsHidden=!this.isDlButtonsHidden},onBuildClicked:function(){this.runPlaylistBuild(this.playlist)},onRemoveBuildJob:function(t){t.playlist_id=this.playlist.id,this.removeBuildJob(t)}}),watch:{playingShotIndex:function(){this.updateTaskPanel()},isComparing:function(){this.isComparing&&this.resetComparison(),this.$nextTick(this.resetCanvas)},taskTypeToCompare:function(){this.isComparing&&this.resetComparison()},shots:function(){var t=this,e=this.$refs["playlisted-shots"],i=e?e.scrollLeft:0;this.shotList=Object.values(this.shots),this.playingShotIndex=0,this.pause(),this.rawPlayer.setCurrentTime(0),this.updateProgressBar(),this.updateTaskPanel(),this.rebuildComparisonOptions(),this.clearCanvas(),this.annotations=[],0===this.shotList.length?(this.rawPlayer.clear(),this.isComparing&&this.$refs["raw-player-comparison"].clear(),this.maxDurationRaw=0,this.maxDuration="00:00.00"):("mp4"!==this.shotList[0].preview_file_extension&&this.$nextTick((function(){t.rawPlayer.loadNextShot()})),this.$nextTick((function(){e&&(e.scrollLeft=i)}))),this.resetHeight()},playlist:function(){var t=this;this.$nextTick((function(){t.updateProgressBar()}))}}},lt=ot,ct=(i("7c2a"),Object(b["a"])(lt,_,x,!1,null,"2ebfe26d",null)),ht=ct.exports;function dt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ut(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?dt(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dt(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var pt={name:"productions",components:{Combobox:p["a"],EntityThumbnail:f["a"],ErrorText:w,PageSubtitle:C["a"],PlaylistPlayer:ht,PlusIcon:h["w"],Spinner:it["a"]},data:function(){return{currentPlaylist:{name:this.$t("playlists.no_selection")},currentShot:0,currentShots:{},sequenceId:null,sequenceOptions:[],sequenceShots:[],modals:{isDeleteDisplayed:!1,isEditDisplayed:!1},loading:{playlist:!1,playlists:!1,addPlaylist:!1,addDaily:!1,addSequence:!1,addWeekly:!1,deletePlaylist:!1},errors:{playlistLoading:!1,addPlaylist:!1,deletePlaylist:!1}}},computed:ut({},Object(c["c"])(["currentEpisode","currentProduction","episodes","isShotsLoading","isTVShow","isCurrentUserManager","playlistMap","playlists","playlistsPath","playlistMap","sequences","shotMap","taskTypeMap"]),{isAdditionLoading:function(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily}}),methods:ut({},Object(c["b"])(["addNewBuildJob","addShotPreviewToPlaylist","changePlaylistOrder","changePlaylistPreview","getPending","loadPlaylist","loadPlaylists","loadShotPreviewFiles","loadShots","markBuildJobAsDone","newPlaylist","refreshPlaylist","removeShotPreviewFromPlaylist","removeBuildJobFromList","updatePreviewAnnotation"]),{formatDate:function(t){return Object(d["a"])(t)},getPlaylistPath:function(t,e){var i={name:e?"".concat(e,"-playlist"):"playlist",params:{production_id:this.currentProduction.id,playlist_id:t}};return this.isTVShow&&this.currentEpisode&&(i.name="episode-".concat(i.name),i.params.episode_id=this.currentEpisode.id),i},loadShotsData:function(t){var e=this;this.loadShots((function(){(e.episodes.length>0||!e.isTVShow)&&e.setAdditionSequences(),e.loadPlaylistsData(),t&&t()}))},loadPlaylistsData:function(){var t=this;this.loading.playlists=!0,this.loadPlaylists((function(e){e&&(t.errors.loadPlaylists=!0),t.loading.playlists=!1,e||t.setCurrentPlaylist((function(){t.currentPlaylist&&t.currentPlaylist.id||t.goFirstPlaylist()}))}))},rebuildCurrentShots:function(){var t=this;this.currentShots={};var e={};this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach((function(i){t.addShotToCurrentShots(i,e)})),this.currentShots=e},addShotToCurrentShots:function(t,e){var i=this.shotMap[t.shot_id];if(i){var s=i.tasks.length>0?i.tasks[0].entity_name:i.name,n={id:t.shot_id,name:i.name,sequence_name:i.sequence_name,entity_name:s,preview_files:t.preview_files,preview_file_id:t.id||t.preview_file_id||i.preview_file_id,preview_file_extension:t.extension||t.preview_file_extension||i.preview_file_extension,preview_file_task_id:t.task_id||t.preview_file_task_id||i.preview_file_task_id,preview_file_annotations:t.annotations||t.preview_file_annotations||i.preview_file_annotations};return e[t.shot_id]=n,n}return null},clearCurrentPlaylist:function(){this.currentPlaylist={},this.currentShots={}},resetPlaylist:function(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addPlaylist:function(){var t=this,e={name:"".concat(l()().format("YYYY-MM-DD HH:mm:ss")),production_id:this.currentProduction.id};this.isTVShow&&this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.loading.addPlaylist=!0,this.errors.addPlaylist=!1,this.newPlaylist({data:e,callback:function(e,i){e&&(t.errors.addPlaylist=!0),t.$router.push(t.getPlaylistPath(i.id)),t.loading.addPlaylist=!1}})},setCurrentPlaylist:function(t){var e=this,i=this.$route.params.playlist_id,s=this.playlistMap[i];this.loading.playlist=!0,s?this.loadPlaylist({playlist:s,callback:function(i,s){e.loading.playlist=!1,i&&console.log(i),e.currentPlaylist=s,e.rebuildCurrentShots(),t&&t()}}):(this.currentPlaylist={name:this.$t("playlists.no_selection")},this.currentShots={})},goFirstPlaylist:function(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},clearAdditionColumn:function(){this.sequenceOptions=[],this.sequenceId=null},setAdditionSequences:function(){var t=this,e=[];e=this.isTVShow&&this.currentEpisode?this.sequences.filter((function(e){return e.parent_id===t.currentEpisode.id})):this.sequences,this.sequenceOptions=e.map((function(t){return{label:t.name,value:t.id}})),this.sequenceId=e.length>0?e[0].id:null},setAdditionShots:function(){var t=this;this.sequenceShots=Object.values(this.shotMap).filter((function(e){return e.sequence_id===t.sequenceId}))},addShot:function(t){var e=this;return this.loadShotPreviewFiles(t).then((function(i){return e.addShotPreviewToPlaylist({playlist:e.currentPlaylist,previewFiles:i,shot:ut({},t)})})).then((function(t){return new Promise((function(i,s){var n=e.addShotToCurrentShots(t,e.currentShots);e.$refs["playlist-player"].shotList.push(n),e.$nextTick((function(){e.$refs["playlist-player"].scrollToRight(),i()}))}))})).catch((function(t){return console.error(t)}))},addShotToPlaylist:function(t){var e=this;this.$options.silent=!0,this.addShot(t).then((function(){setTimeout((function(){e.$options.silent=!1}),500)}))},addSequence:function(){var t=this;this.$options.silent=!0,this.loading.addSequence=!0;var e=Object(a["a"])(this.sequenceShots).reverse();this.addShots(e,(function(){t.loading.addSequence=!1,t.$options.silent=!1}))},addAllPending:function(){var t=this;this.$options.silent=!0,this.loading.addWeekly=!0,this.getPending(!1).then((function(e){t.addShots(e.reverse(),(function(){t.loading.addWeekly=!1,t.$options.silent=!1}))}))},addDailyPending:function(){var t=this;this.loading.addDaily=!0,this.$options.silent=!0,this.getPending(!0).then((function(e){t.addShots(e.reverse(),(function(){t.loading.addDaily=!1,t.$options.silent=!1}))}))},addShots:function(t,e){var i=this;if(t&&t.length>0){var s=t.pop();this.addShot(s).then((function(){i.addShots(t,e)}))}else e()},removeShot:function(t){var e=this;this.removeShotPreviewFromPlaylist({playlist:this.currentPlaylist,shot:t,callback:function(){delete e.currentShots[t.id]}})},onPreviewChanged:function(t,e){this.changePlaylistPreview({playlist:this.currentPlaylist,shot:t,previewFileId:e})},onOrderChange:function(t){this.changePlaylistOrder({playlist:this.currentPlaylist,info:t})},onAnnotationChanged:function(t){var e=t.preview,i=t.annotations,s=e.task_id;this.updatePreviewAnnotation({taskId:s,preview:e,annotations:i})}}),mounted:function(){var t=this;setTimeout((function(){t.loadShotsData((function(){t.setAdditionSequences(),t.resetPlaylist()}))}),0)},watch:{$route:function(){this.setCurrentPlaylist()},sequenceId:function(){this.setAdditionShots()},currentProduction:function(){var t=this;this.loadShotsData((function(){t.setAdditionSequences(),t.resetPlaylist()}))},currentEpisode:function(){var t=this;this.currentEpisode&&this.loadShotsData((function(){t.setAdditionSequences(),t.resetPlaylist()}))}},metaInfo:function(){return this.isTVShow?{title:"".concat(this.currentProduction?this.currentProduction.name:""," ")+"- ".concat(this.currentEpisode?this.currentEpisode.name:""," |")+" ".concat(this.$t("playlists.title")," - Kitsu")}:{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" ".concat(this.$t("playlists.title"))+" - Kitsu"}},socket:{events:{"playlist:new":function(t){this.playlistMap[t.playlist_id]||this.refreshPlaylist(t.playlist_id)},"playlist:update":function(t){var e=this;this.playlistMap[t.playlist_id]&&!this.$options.silent&&this.refreshPlaylist(t.playlist_id).then((function(t){e.currentPlaylist.id===t.id&&(Object.assign(e.currentPlaylist,t),e.rebuildCurrentShots())}))},"playlist:delete":function(t){this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update":function(t){t.playlist_id===this.currentPlaylist.id&&Object(u["f"])(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=Object(u["e"])(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}}},ft=pt,yt=(i("0498"),Object(b["a"])(ft,s,n,!1,null,"2aa68e79",null));e["default"]=yt.exports},d5fa:function(t,e,i){},f3e6:function(t,e,i){"use strict";var s=i("9fbb"),n=i.n(s);n.a}}]);
//# sourceMappingURL=chunk-5c38ed31.f4fe8d5b.js.map