(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a1362dbe"],{3300:function(e,t,s){},"370b":function(e,t,s){"use strict";var i=s("3300"),n=s.n(i);n.a},3984:function(e,t,s){"use strict";var i=s("b3a7"),n=s.n(i);n.a},"6b6c":function(e,t,s){"use strict";var i=s("6d53"),n=s.n(i);n.a},"6d53":function(e,t,s){},"6ebc":function(e,t,s){},b131:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("td",{staticClass:"validation"},["pie"===e.displayMode?s("div",[s("pie-chart",{attrs:{width:"70px",height:"50px",legend:!1,colors:e.colors,data:e.selectedData}})],1):s("div",e._l(e.selectedData,(function(t){return t[0]?s("div",{key:t[0]},[s("span",{staticClass:"stats-name",style:{color:t[2]}},[e._v(" "+e._s(t[0])+" ")]),s("span",[e._v(" : ")]),s("span",{staticClass:"stats-value"},[e._v(" "+e._s(t[1])+" ("+e._s(e.percent(t[1]))+"%) ")])]):e._e()})),0)])},n=[],a=(s("13d5"),s("b680"),{name:"stats-cell",components:{},props:{colors:{type:Array,required:!0},countMode:{type:String,default:"count"},data:{type:Array,default:function(){return[]}},displayMode:{type:String,default:"pie"},framesData:{type:Array,default:function(){return[]}}},computed:{selectedData:function(){return"frames"===this.countMode?this.framesData:this.data},total:function(){return this.selectedData.reduce((function(e,t){return t[1]?e+t[1]:e}),0)}},methods:{percent:function(e){var t=0;return this.total>0&&(t=e/this.total*100),t.toFixed(2)}}}),r=a,o=(s("d1de"),s("2877")),c=Object(o["a"])(r,i,n,!1,null,"77213702",null);t["a"]=c.exports},b3a7:function(e,t,s){},d1de:function(e,t,s){"use strict";var i=s("6ebc"),n=s.n(i);n.a},d214:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sequences page fixed-page"},[s("div",{staticClass:"sequence-list-header page-header flexrow"},[s("search-field",{ref:"sequence-search-field",staticClass:"flexrow-item mt1",attrs:{"can-save":!0,placeholder:"ex: e01 s01 anim=wip"},on:{change:e.onSearchChange,save:e.saveSearchQuery}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{label:e.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:e.displayModeOptions},model:{value:e.displayMode,callback:function(t){e.displayMode=t},expression:"displayMode"}}),s("combobox",{staticClass:"mb0 flexrow-item",attrs:{label:e.$t("statistics.count_mode"),"locale-key-prefix":"statistics.",options:e.countModeOptions},model:{value:e.countMode,callback:function(t){e.countMode=t},expression:"countMode"}}),s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{icon:"download"},on:{click:e.exportStatisticsToCsv}})],1),s("div",{staticClass:"query-list mt1"},[s("search-query-list",{attrs:{queries:e.sequenceSearchQueries},on:{changesearch:e.changeSearch,removesearch:e.removeSearchQuery}})],1),s("sequence-list",{ref:"sequence-list",attrs:{"count-mode":e.countMode,"display-mode":e.displayMode,entries:e.displayedSequences,"is-loading":e.isShotsLoading||e.initialLoading,"is-error":e.isShotsLoadingError,"validation-columns":e.shotValidationColumns,"sequence-stats":e.sequenceStats,"show-all":0===e.sequenceSearchText.length},on:{scroll:e.saveScrollPosition}}),s("edit-sequence-modal",{attrs:{active:e.modals.isNewDisplayed,"is-loading":e.loading.edit,"is-error":e.errors.edit,"cancel-route":e.sequencesPath,"sequence-to-edit":e.sequenceToEdit},on:{confirm:e.confirmEditSequence}}),s("hard-delete-modal",{attrs:{active:e.modals.isDeleteDisplayed,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText(),"error-text":e.$t("sequences.delete_error"),"cancel-route":e.sequencesPath,"lock-text":e.sequenceToDelete?e.sequenceToDelete.name:""},on:{confirm:e.confirmDeleteSequence}})],1)},n=[],a=(s("a4d3"),s("4de4"),s("4160"),s("c975"),s("a15b"),s("a434"),s("b0c0"),s("e439"),s("dbb4"),s("b64b"),s("159b"),s("ade3")),r=s("c1df"),o=s.n(r),c=s("2f62"),l=s("3455"),u=s("8c97"),d=s("de40"),h=s("992f"),f=s("2c1a"),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{modal:!0,"is-active":e.active}},[s("div",{staticClass:"modal-background",on:{click:function(t){return e.$emit("cancel")}}}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box"},[e.sequenceToEdit&&this.sequenceToEdit.id?s("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("sequences.edit_title"))+" "+e._s(e.sequenceToEdit.name)+" ")]):s("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("sequences.new_sequence"))+" ")]),s("form",{on:{submit:function(e){e.preventDefault()}}},[s("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:e.$t("sequences.fields.name")},on:{enter:e.runConfirmation},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),s("textarea-field",{ref:"descriptionField",attrs:{label:e.$t("sequences.fields.description")},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.runConfirmation(t):null}},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),s("div",{staticClass:"has-text-right"},[s("a",{class:{button:!0,"is-primary":!0,"is-loading":e.isLoading},on:{click:e.confirmClicked}},[e._v(" "+e._s(e.$t("main.confirmation"))+" ")]),s("router-link",{staticClass:"button is-link",attrs:{to:e.cancelRoute}},[e._v(" "+e._s(e.$t("main.cancel"))+" ")]),e.isError?s("p",{staticClass:"error has-text-right info-message"},[e._v(" "+e._s(e.$t("sequences.edit_fail"))+" ")]):e._e(),s("p",{staticClass:"success has-text-right info-message"},[e._v(" "+e._s(e.sequenceSuccessText)+" ")])],1)])])])},m=[],y=(s("e01a"),s("7bf8")),q=s("1149");function b(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function S(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?b(Object(s),!0).forEach((function(t){Object(a["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var v={name:"edit-sequence-modal",components:{TextField:y["a"],TextareaField:q["a"]},props:["onConfirmClicked","text","active","cancelRoute","isError","isLoading","isLoadingStay","isSuccess","sequenceToEdit","errorText"],data:function(){return this.sequenceToEdit&&this.sequenceToEdit.id?{form:{id:this.sequenceToEdit.id,name:this.sequenceToEdit.name,description:this.sequenceToEdit.description,production_id:this.sequenceToEdit.project_id},sequenceSuccessText:""}:{form:{id:"",name:"",description:"",fps:""},sequenceSuccessText:""}},computed:S({},Object(c["c"])(["currentProduction"])),methods:S({},Object(c["b"])([]),{runConfirmation:function(){this.confirmClicked()},confirmClicked:function(){this.$emit("confirm",this.form)},isEditing:function(){return this.sequenceToEdit&&this.sequenceToEdit.id},resetForm:function(){this.sequenceSuccessText="",this.isEditing()?this.form={id:this.sequenceToEdit.id,name:this.sequenceToEdit.name,description:this.sequenceToEdit.description}:(this.form.id=null,this.form.name="",this.form.description="")}}),mounted:function(){this.resetForm()},watch:{active:function(){this.resetForm()},sequenceToEdit:function(){this.resetForm()}}},g=v,_=(s("3984"),s("2877")),C=Object(_["a"])(g,p,m,!1,null,"c72139f0",null),O=C.exports,T=s("4d04"),E=s("55ce"),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"data-list"},[s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[s("table",{staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{ref:"th-sequence",staticClass:"name datatable-row-header",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("shots.fields.sequence"))+" ")]),s("th",{staticClass:"description",attrs:{scope:"col"}},[e._v(e._s(e.$t("shots.fields.description")))]),s("th",{staticClass:"validation",attrs:{scope:"col"}},[e._v(e._s(e.$t("main.all")))]),e._l(e.validationColumns,(function(t){return e.isLoading?e._e():s("th",{key:t,staticClass:"validation validation-cell",attrs:{scope:"col"}},[s("div",{staticClass:"flexrow validation-content",style:e.getValidationStyle(t)},[e.isCurrentUserClient?s("span",{staticClass:"flexrow-item"},[e._v(" "+e._s(e.taskTypeMap[t].name)+" ")]):s("router-link",{staticClass:"flexrow-item",attrs:{to:e.taskTypePath(t)}},[e._v(" "+e._s(e.taskTypeMap[t].name)+" ")])],1)])})),s("th",{staticClass:"actions",attrs:{scope:"col"}})],2)]),e.isLoading?e._e():s("tbody",{staticClass:"datatable-body"},[e.showAll&&!e.isEmptyList?s("tr",{staticClass:"all-line datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[e._v(" "+e._s(e.$t("sequences.all_sequences"))+" ")]),s("td",{staticClass:"description"}),s("stats-cell",{staticClass:"all-validation",attrs:{colors:e.chartColors("all","all"),data:e.chartData("all","all"),"frames-data":e.chartData("all","all","frames"),countMode:e.countMode,displayMode:e.displayMode}}),e._l(e.validationColumns,(function(t){return s("stats-cell",{key:"all-"+t,style:e.getValidationStyle(t),attrs:{colors:e.chartColors("all",t),data:e.chartData("all",t),"frames-data":e.chartData("all",t,"frames"),countMode:e.countMode,displayMode:e.displayMode}})})),s("td",{staticClass:"actions"})],2):e._e(),e._l(e.entries,(function(t){return e.isEntryStats(t.id)?s("tr",{key:t.id,staticClass:"datatable-row"},[s("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[e._v(" "+e._s(t.name)+" ")]),s("td",{staticClass:"description"},[e._v(" "+e._s(t.description)+" ")]),e.isStats(t.id,"all")?s("stats-cell",{attrs:{colors:e.chartColors(t.id,"all"),data:e.chartData(t.id,"all"),"frames-data":e.chartData(t.id,"all","frames"),countMode:e.countMode,displayMode:e.displayMode}}):s("td"),e._l(e.validationColumns,(function(i){return e.isStats(t.id,i)?s("stats-cell",{key:t.id+i,style:e.getValidationStyle(i),attrs:{colors:e.chartColors(t.id,i),data:e.chartData(t.id,i),"frames-data":e.chartData(t.id,i,"frames"),countMode:e.countMode,displayMode:e.displayMode}}):s("td",{style:e.getValidationStyle(i)})})),e.isCurrentUserManager?s("row-actions",{attrs:{entry:t,"edit-route":e.editPath(t.id),"delete-route":e.deletePath(t.id)}}):s("td",{staticClass:"actions"})],2):e._e()}))],2)])]),s("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),!e.isEmptyList||e.isCurrentUserClient||e.isLoading?e._e():s("div",{staticClass:"has-text-centered"},[e._m(0),s("p",{staticClass:"info"},[e._v(e._s(e.$t("sequences.empty_list")))])]),e.isEmptyList&&e.isCurrentUserClient&&!e.isLoading?s("div",{staticClass:"has-text-centered"},[e._m(1),s("p",{staticClass:"info"},[e._v(e._s(e.$t("sequences.empty_list_client")))])]):e._e(),e.isEmptyList||e.isLoading?e._e():s("p",{staticClass:"has-text-centered nb-sequences"},[e._v(" "+e._s(e.displayedSequencesLength)+" "+e._s(e.$tc("sequences.number",e.displayedSequencesLength))+" ")])],1)},x=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",{staticClass:"info"},[i("img",{attrs:{src:s("732b")}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",{staticClass:"info"},[i("img",{attrs:{src:s("732b")}})])}],M=(s("d3b7"),s("ddb0"),s("09d3")),P=s("e9c6"),D=s("03b1"),j=s("e60b"),$=s("b131");function k(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function L(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?k(Object(s),!0).forEach((function(t){Object(a["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var V={name:"sequence-list",mixins:[P["a"]],components:{RowActions:D["a"],StatsCell:$["a"],TableInfo:j["a"]},props:{countMode:{type:String,default:"count"},displayMode:{type:String,default:"pie"},entries:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},sequenceStats:{type:Object,default:function(){}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:function(){return[]}}},data:function(){return{busy:!1,lastSelection:null}},computed:L({},Object(c["c"])(["currentProduction","currentEpisode","displayedSequencesLength","isDarkTheme","isCurrentUserClient","isCurrentUserManager","isTVShow","sequenceSearchText","taskTypeMap"]),{isEmptyList:function(){return this.entries&&0===this.entries.length&&!this.isLoading&&!this.isError&&(!this.sequenceSearchText||0===this.sequenceSearchText.length)}}),methods:L({},Object(c["b"])(["displayMoreSequences","loadMoreSequences"]),{chartColors:function(e,t){return Object(M["b"])(this.sequenceStats,e,t)},chartData:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"count";return Object(M["c"])(this.sequenceStats,e,t,s)},isStats:function(e,t){return this.sequenceStats[e]&&this.sequenceStats[e][t]},isEntryStats:function(e){var t=this;if(!this.sequenceStats[e]&&this.sequenceSearchText)return!1;if(!this.sequenceStats[e])return!0;var s=!1;return Object.keys(this.sequenceStats[e]).forEach((function(i){s=s||t.sequenceStats[e][i]})),s},onBodyScroll:function(e,t){this.$emit("scroll",t.scrollTop);var s=this.$refs.body.scrollHeight-this.$refs.body.offsetHeight;s<t.scrollTop+100&&this.loadMoreSequences()},loadMoreSequences:function(){this.displayMoreSequences()},setScrollPosition:function(e){this.$refs.body&&(this.$refs.body.scrollTop=e)},resizeHeaders:function(){return!0},editPath:function(e){return this.getPath("edit-sequence",e)},deletePath:function(e){return this.getPath("delete-sequence",e)},taskTypePath:function(e){var t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:"shots"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t},getPath:function(e,t){var s={name:e,params:{production_id:this.currentProduction.id}};return this.isTVShow&&this.currentEpisode&&(s.name="episode-".concat(e),s.params.episode_id=this.currentEpisode.id),t&&(s.params.sequence_id=t),s}})},F=V,H=(s("6b6c"),Object(_["a"])(F,w,x,!1,null,"34fff6f1",null)),A=H.exports;function z(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function N(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?z(Object(s),!0).forEach((function(t){Object(a["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):z(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Q={name:"sequences",components:{ButtonSimple:d["a"],Combobox:h["a"],HardDeleteModal:f["a"],EditSequenceModal:O,SearchField:T["a"],SearchQueryList:E["a"],SequenceList:A},data:function(){return{countMode:"count",displayMode:"pie",initialLoading:!0,sequenceToDelete:null,sequenceToEdit:null,countModeOptions:[{label:"shots",value:"count"},{label:"frames",value:"frames"}],displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}],errors:{edit:!1,del:!1},loading:{edit:!1,del:!1},modals:{isNewDisplayed:!1,isDeleteDisplayed:!1}}},computed:N({},Object(c["c"])(["currentEpisode","currentProduction","displayedSequences","isCurrentUserManager","isShotsLoading","isShotsLoadingError","isTVShow","searchSequenceFilters","sequences","sequenceMap","sequencesPath","sequenceStats","sequenceSearchText","sequenceSearchQueries","sequenceListScrollPosition","shotValidationColumns","taskTypeMap","taskStatusMap"])),mounted:function(){var e=this;setTimeout((function(){e.initSequences().then(e.handleModalsDisplay).then(e.resizeHeaders).then((function(){e.initialLoading=!1})),e.setDefaultSearchText(),e.setDefaultListScrollPosition()}),100)},methods:N({},Object(c["b"])(["computeSequenceStats","deleteSequence","editSequence","hideAssignations","initSequences","loadComment","removeSequenceSearch","saveSequenceSearch","setLastProductionScreen","setSequenceSearch","setSequenceListScrollPosition","showAssignations"]),{setDefaultSearchText:function(){this.sequenceSearchText.length>0&&this.$refs["sequence-search-field"].setValue(this.sequenceSearchText)},setDefaultListScrollPosition:function(){this.$refs["sequence-list"]&&this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition)},navigateToList:function(){this.$router.push(this.sequencesPath)},confirmEditSequence:function(e){var t=this;this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then((function(){t.loading.edit=!1,t.resizeHeaders(),t.navigateToList()})).catch((function(){t.loading.edit=!1,t.errors.edit=!0}))},confirmDeleteSequence:function(){var e=this;this.loading.del=!0,this.deleteSequence(this.sequenceToDelete).then((function(){e.loading.del=!1,e.resizeHeaders(),e.navigateToList()})).catch((function(){e.loading.del=!1,e.errors.del=!0}))},resetEditModal:function(){var e={name:""};this.sequences.length>0&&(e.sequence_id=this.sequences[0].id),this.openProductions.length>0&&(e.production_id=this.openProductions[0].id),this.sequenceToEdit=e},deleteText:function(){var e=this.sequenceToDelete;return e?this.$t("sequences.delete_text",{name:e.name}):""},handleModalsDisplay:function(){var e=this.$store.state.route.path,t=this.$store.state.route.params.sequence_id;this.errors={edit:!1,delete:!1},this.modals={isNewDisplayed:!1,isDeleteDisplayed:!1},e.indexOf("edit")>0?(this.sequenceToEdit=this.sequenceMap[t],this.modals.isNewDisplayed=!0):e.indexOf("delete")>0&&(this.sequenceToDelete=this.sequenceMap[t],this.modals.isDeleteDisplayed=!0)},onSearchChange:function(e){var t=this.$refs["sequence-search-field"].getValue();this.setSequenceSearch(t)},changeSearch:function(e){this.$refs["sequence-search-field"].setValue(e.search_query),this.$refs["sequence-search-field"].$emit("change",e.search_query),this.resizeHeaders()},saveSearchQuery:function(e){this.saveSequenceSearch(e).catch(console.error)},removeSearchQuery:function(e){this.removeSequenceSearch(e).catch(console.error)},saveScrollPosition:function(e){this.setSequenceListScrollPosition(e)},resizeHeaders:function(){var e=this;setTimeout((function(){e.$refs["sequence-list"]&&e.$refs["sequence-list"].resizeHeaders()}),100)},exportStatisticsToCsv:function(){var e=[o()().format("YYYYMMDD"),this.currentProduction.name,"sequences","statistics"];this.currentEpisode&&e.splice(2,0,this.currentEpisode.name);var t=Object(u["b"])(e.join("_"));l["a"].generateStatReports(t,this.sequenceStats,this.taskTypeMap,this.taskStatusMap,this.sequenceMap,this.countMode)}}),watch:{$route:function(){this.handleModalsDisplay()},currentProduction:function(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.isTVShow||this.initSequences().then(this.handleModalsDisplay).then(this.resizeHeaders)},currentEpisode:function(){var e=this;this.isTVShow&&this.currentEpisode&&this.initSequences().then(this.handleModalsDisplay).then(this.resizeHeaders).then((function(){e.initialLoading=!1}))},searchSequenceFilters:function(){this.computeSequenceStats()}},socket:{events:{"comment:new":function(e){}}},metaInfo:function(){return this.isTVShow?{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" - ".concat(this.currentEpisode?this.currentEpisode.name:"")+" | ".concat(this.$t("sequences.title")," - Kitsu")}:{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" ".concat(this.$t("sequences.title")," - Kitsu")}}},U=Q,B=(s("370b"),Object(_["a"])(U,i,n,!1,null,"36333d27",null));t["default"]=B.exports}}]);
//# sourceMappingURL=chunk-a1362dbe.a5fca0cc.js.map