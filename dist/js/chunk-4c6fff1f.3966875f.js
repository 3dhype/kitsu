(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c6fff1f"],{"19b3":function(t,e,i){"use strict";var s=i("979d"),n=i.n(s);n.a},2067:function(t,e,i){"use strict";var s=i("5a71"),n=i.n(s);n.a},"215c":function(t,e,i){"use strict";var s=i("e173"),n=i.n(s);n.a},"45df":function(t,e,i){},5995:function(t,e,i){"use strict";var s=i("5dcc"),n=i.n(s);n.a},"5a71":function(t,e,i){},"5dcc":function(t,e,i){},7203:function(t,e,i){"use strict";var s=i("e92a"),n=i.n(s);n.a},"979d":function(t,e,i){},d1e3:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"productions page fixed-page"},[i("div",{staticClass:"columns"},[t.playlists.length>0?i("div",{staticClass:"playlist-list-column column"},[t.isCurrentUserManager?i("button",{key:"new-playlist-button",class:{button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[i("plus-icon",{staticClass:"icon is-small"}),t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")],1):t._e(),t.loading.playlists?i("spinner",{staticClass:"mt2"}):i("div",{staticClass:"playlists"},t._l(t.playlists,(function(e){return i("router-link",{key:e.id,class:{"playlist-item":!0,"for-client":e.for_client||!1,selected:e.id===t.currentPlaylist.id},attrs:{to:t.getPlaylistPath(e.id)}},[i("span",[t._v(" "+t._s(e.name)+" ")]),i("span",{staticClass:"playlist-date",attrs:{title:"last modified"}},[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(e.updated_at))+" ")])])})),1),t.errors.playlistLoading?i("error-text",{attrs:{text:"$t('playlists.loading_error')"}}):t._e()],1):t._e(),t.playlists.length>0&&!t.currentPlaylist.id?i("div",{staticClass:"playlist-column no-selection"},[i("h2",[t._v(t._s(t.$t("playlists.last_creation")))]),t.loading.playlists?i("spinner",{staticClass:"mt2"}):i("div",{staticClass:"flexrow"},t._l(t.lastPlaylistsCreated,(function(e){return i("router-link",{key:"recent-playlist-"+e.id,staticClass:"recent-playlist flexrow-item",attrs:{to:t.getPlaylistPath(e.id)}},[i("light-entity-thumbnail",{attrs:{"preview-file-id":e.first_preview_file_id,type:"previews",width:"300px",height:"auto","empty-height":"150px"}}),i("h3",[t._v(t._s(e.name))]),i("span",[t._v(" "+t._s(t.$t("playlists.created_at"))+" "+t._s(t.formatDate(e.created_at))+" ")])],1)})),1),i("h2",[t._v(t._s(t.$t("playlists.last_modification")))]),t.loading.playlists?i("spinner",{staticClass:"mt2"}):i("div",{staticClass:"flexrow"},t._l(t.lastPlaylistsUpdated,(function(e){return i("router-link",{key:"recent-modified-playlist-"+e.id,staticClass:"recent-playlist flexrow-item",attrs:{to:t.getPlaylistPath(e.id)}},[i("light-entity-thumbnail",{attrs:{"preview-file-id":e.first_preview_file_id,type:"previews",width:"300px",height:"auto","empty-height":"150px"}}),i("h3",[t._v(t._s(e.name))]),i("span",[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(e.updated_at))+" ")])],1)})),1)],1):0===t.playlists.length?i("div",{staticClass:"playlist-column no-selection has-text-centered"},[t.loading.playlists?i("spinner",{staticClass:"mt2"}):i("div",[i("p",{staticClass:"empty-explaination"},[t._v(" "+t._s(t.$t("playlists.no_playlist"))+" ")]),t.isCurrentUserManager?i("button",{key:"new-playlist-button",class:{big:!0,button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")]):t._e()])],1):i("div",{staticClass:"playlist-column column"},[i("playlist-player",{ref:"playlist-player",attrs:{playlist:t.currentPlaylist,shots:t.currentShots,"is-loading":t.loading.playlist,"is-adding-shot":t.isAddingShot},on:{"edit-clicked":t.showEditModal,"show-add-shots":t.toggleAddShots,"preview-changed":t.onPreviewChanged,"playlist-deleted":t.goFirstPlaylist,"remove-shot":t.removeShot,"order-change":t.onOrderChange,annotationchanged:t.onAnnotationChanged,"for-client-changed":t.onForClientChanged}}),t.isCurrentUserManager&&t.isAddingShot?i("div",[i("div",{staticClass:"addition-header"},[i("div",{staticClass:"flexrow"},[i("page-subtitle",{staticClass:"flexrow-item",attrs:{text:t.$t("playlists.add_shots")}}),i("span",{staticClass:"filler"}),i("button"),i("a",{staticClass:"close-button",on:{click:t.toggleAddShots}},[i("x-icon")],1)],1),i("div",{staticClass:"flexrow"},[i("search-field",{ref:"search-field",staticClass:"flexrow-item",attrs:{"can-save":!1,placeholder:"ex: seq01 anim=wfa"},on:{change:t.onSearchChange}}),t.shotSearchText?i("button",{class:{button:!0,"flexrow-item":!0,"add-sequence":!0},attrs:{disabled:t.isAdditionLoading},on:{click:t.addCurrentSelection}},[t._v(" "+t._s(t.$t("playlists.add_selection"))+" ")]):t._e(),i("span",{staticClass:"filler"}),t.isTVShow?i("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addEpisode},attrs:{disabled:t.isAdditionLoading},on:{click:t.addEpisodePending}},[t._v(" "+t._s(t.$t("playlists.add_episode"))+" ")]):i("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addMovie},attrs:{disabled:t.isAdditionLoading},on:{click:t.addMovie}},[t._v(" "+t._s(t.$t("playlists.add_movie"))+" ")])],1)])]):t._e(),t.isCurrentUserManager&&t.isAddingShot?i("div",{staticClass:"addition-section"},[t.isShotsLoading?i("spinner",{key:"shot-loader",staticClass:"mt2"}):i("div",[i("div",t._l(t.displayedShotsBySequence,(function(e,s){return i("div",{key:"sequence-"+s},[e.length>0?i("h2",{staticClass:"sequence-title"},[t._v(" "+t._s(e[0].sequence_name)+" "),t.isCurrentUserManager?i("button",{key:"add-sequence-button-"+e[0].sequence_id,staticClass:"button",on:{click:function(i){return t.addSequence(e)}}},[t._v(" "+t._s(t.$t("playlists.add_sequence"))+" ")]):t._e()]):t._e(),i("div",{staticClass:"addition-shots"},t._l(e,(function(e){return i("div",{key:e.id,class:{"addition-shot":!0,playlisted:void 0!==t.currentShots[e.id]},on:{click:function(i){return i.preventDefault(),t.addShotToPlaylist(e)}}},[i("light-entity-thumbnail",{attrs:{"preview-file-id":e.preview_file_id,width:"150px",height:"100px"}}),i("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(e.name))])],1)})),0)])})),0)])],1):t._e()],1)]),i("edit-playlist-modal",{ref:"edit-playlist-modal",attrs:{active:t.modals.isEditDisplayed,"is-loading":t.loading.editPlaylist,"is-error":t.errors.editPlaylist,"playlist-to-edit":t.playlistToEdit},on:{cancel:t.hideEditModal,confirm:t.confirmEditPlaylist}})],1)},n=[],a=(i("a4d3"),i("99af"),i("4de4"),i("4160"),i("fb6a"),i("b0c0"),i("e439"),i("dbb4"),i("b64b"),i("d3b7"),i("07ac"),i("159b"),i("2909")),r=i("ade3"),o=i("ba4c"),l=i.n(o),c=i("ceca"),d=i.n(c),h=i("7f45"),u=i.n(h),p=i("2f62"),f=i("0a35"),y=i("3657"),m=i("66e7"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{modal:!0,"is-active":t.active}},[i("div",{staticClass:"modal-background"}),i("div",{staticClass:"modal-content"},[i("div",{staticClass:"box"},[t.playlistToEdit&&t.playlistToEdit.id?i("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("playlists.edit_title"))+" ")]):i("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("playlists.create_title"))+" ")]),i("form",{on:{submit:function(t){t.preventDefault()}}},[i("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("playlists.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),i("combobox",{attrs:{label:t.$t("playlists.fields.for_client"),options:t.forClientOptions},model:{value:t.forClient,callback:function(e){t.forClient=e},expression:"forClient"}})],1),i("p",{staticClass:"has-text-right"},[i("a",{class:{button:!0,"is-primary":!0,"is-loading":t.isLoading},on:{click:t.runConfirmation}},[t._v(" "+t._s(t.$t("main.confirmation"))+" ")]),i("button",{staticClass:"button is-link",on:{click:function(e){return t.$emit("cancel")}}},[t._v(" "+t._s(t.$t("main.cancel"))+" ")])]),t.isError?i("p",{staticClass:"error has-text-right info-message"},[t._v(" "+t._s(t.$t("assets.edit_fail"))+" ")]):t._e()])])])},g=[],P=i("992f"),b=i("7bf8"),w=i("d065"),C={name:"edit-playlist-modal",mixins:[w["a"]],components:{Combobox:P["a"],TextField:b["a"]},props:["active","cancelRoute","isLoading","isError","playlistToEdit"],data:function(){return{forClient:"false",forClientOptions:[{label:this.$t("playlists.for_client"),value:"true"},{label:this.$t("playlists.for_studio"),value:"false"}],form:{name:this.playlistToEdit.name,for_client:this.playlistToEdit.for_client}}},methods:{runConfirmation:function(){this.form.for_client="true"===this.forClient,this.$emit("confirm",this.form)}},watch:{playlistToEdit:function(){this.playlistToEdit?this.form.name=this.playlistToEdit.name:this.form={name:""}},active:function(){var t=this;this.active&&(this.forClient=this.playlistToEdit.for_client?"true":"false",setTimeout((function(){t.$refs.nameField.focus()}),100))}}},_=C,x=(i("19b3"),i("2877")),k=Object(x["a"])(_,v,g,!1,null,"1d7ab2c7",null),S=k.exports,$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{class:{error:!0,"has-text-right":t.alignRight,"is-hidden":t.hidden}},[t._v(" "+t._s(t.text)+" ")])},T=[],O={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}},D=O,E=Object(x["a"])(D,$,T,!1,null,null,null),j=E.exports,F=function(t,e){var i=e._c;return e.props.previewFileId?i("img",e._b({directives:[{name:"lazy",rawName:"v-lazy",value:"/api/pictures/"+e.props.type+"/preview-files/"+e.props.previewFileId+".png",expression:"'/api/pictures/' + props.type + '/preview-files/' + props.previewFileId + '.png'"}],key:e.props.previewFileId,staticClass:"thumbnail-picture",style:{width:e.props.width,height:e.props.height}},"img",e.data.attrs,!1)):i("span",e._b({class:{"thumbnail-picture":!0,"thumbnail-empty":!0},style:{width:e.props.width,height:e.props.emptyHeight?e.props.emptyHeight:e.props.height}},"span",e.data.attrs,!1))},M=[],L={name:"light-entity-thumbnail",functional:!0,props:{previewFileId:{default:"",type:String},width:{default:"150px",type:String},height:{default:"50px",type:String},emptyHeight:{type:String},type:{default:"thumbnails",type:String}}},A=L,I=(i("7203"),Object(x["a"])(A,F,M,!0,null,null,null)),H=I.exports,B=i("8751"),R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",class:{dark:!0,"full-height":!t.isAddingShot,"playlist-player":!0}},[i("div",{ref:"header",staticClass:"playlist-header flexrow"},[t.playlist&&t.playlist.for_client?i("div",{staticClass:"flexrow-item for-client"},[t._v(" "+t._s(t.$t("playlists.client_playlist"))+" ")]):t._e(),i("span",{staticClass:"flexrow-item playlist-name"},[t._v(" "+t._s(t.playlist.name)+" ")]),t.isCurrentUserManager&&!t.isAddingShot?i("button-simple",{staticClass:"playlist-button add-shots-button flexrow-item",attrs:{icon:"plus",text:"Add Shots"},on:{click:function(e){return t.$emit("show-add-shots")}}}):t._e(),t.isCurrentUserManager?i("button-simple",{staticClass:"edit-button playlist-button flexrow-item",attrs:{icon:"edit"},on:{click:function(e){return t.$emit("edit-clicked")}}}):t._e(),t.isCurrentUserManager?i("button-simple",{staticClass:"delete-button playlist-button flexrow-item",attrs:{icon:"delete"},on:{click:t.showDeleteModal}}):t._e()],1),t.isAddingShot?t._e():i("div",{ref:"video-container",staticClass:"filler flexrow video-container"},[i("raw-video-player",{ref:"raw-player",staticClass:"raw-player",attrs:{shots:t.shotList},on:{"metadata-loaded":t.onMetadataLoaded,"shot-change":t.onShotChange,"time-update":t.onTimeUpdate,"max-duration-update":t.onMaxDurationUpdate}}),t.isComparing?i("raw-video-player",{ref:"raw-player-comparison",staticClass:"raw-player",attrs:{shots:t.shotListToCompare}}):t._e(),i("div",{ref:"canvas-wrapper",staticClass:"canvas-wrapper"},[i("canvas",{ref:"annotation-canvas",staticClass:"canvas",attrs:{id:"annotation-canvas"}})]),i("task-info",{ref:"task-info",class:{"flexrow-item":!0,"task-info-column":!0,hidden:t.isCommentsHidden},attrs:{task:t.task,"is-preview":!1}})],1),t.isAddingShot?t._e():i("div",{ref:"playlist-progress",staticClass:"playlist-progress"},[i("div",{staticClass:"video-progress"},[i("progress",{ref:"progress",attrs:{value:"0",min:"0"},on:{click:t.onProgressBarClicked}},[i("span",{ref:"progress-bar",attrs:{id:"progress-bar"}})])])]),t.playlist.id&&!t.isAddingShot?i("annotation-bar",{ref:"playlist-annotation",staticClass:"playlist-annotations",attrs:{annotations:t.annotations,"max-duration-raw":t.maxDurationRaw},on:{"select-annotation":t.loadAnnotation}}):t._e(),t.playlist.id&&!t.isAddingShot?i("div",{ref:"button-bar",staticClass:"playlist-footer flexrow"},[t.isPlaying?i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"pause"},on:{click:t.onPlayClicked}}):i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"play"},on:{click:t.onPlayClicked}}),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" "+t._s(t.currentTime)+" ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" / ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" "+t._s(t.maxDuration)+" ")]),i("span",{staticClass:"flexrow-item time-indicator mr1"},[t._v(" ("+t._s(t.currentFrame)+") ")]),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"left"},on:{click:t.onPreviousFrameClicked}}),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"right"},on:{click:t.onNextFrameClicked}}),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" "+t._s(t.shotList.length>0?t.playingShotIndex+1:0)+" ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" / ")]),i("span",{staticClass:"flexrow-item time-indicator mr1"},[t._v(" "+t._s(t.shotList.length)+" ")]),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"back"},on:{click:t.onPlayPreviousShotClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"forward"},on:{click:t.onPlayNextShotClicked}}),t.taskTypeOptions?i("button-simple",{class:{"comparison-button":!0,"flexrow-item":!0,"playlist-button":!0,active:t.isComparing},attrs:{icon:"compare"},on:{click:t.onCompareClicked}}):t._e(),t.isComparing?i("combobox",{staticClass:"playlist-button flexrow-item comparison-list",attrs:{options:t.taskTypeOptions},model:{value:t.taskTypeToCompare,callback:function(e){t.taskTypeToCompare=e},expression:"taskTypeToCompare"}}):t._e(),i("span",{staticClass:"filler"}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"undo"},on:{click:t.undoLastAction}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"redo"},on:{click:t.redoLastAction}}),i("pencil-picker",{attrs:{isActive:t.isDrawing,isOpen:t.isShowingPencilPalette,pencil:t.pencil,palette:this.pencilPalette},on:{"toggle-palette":t.onPickPencil,change:t.onChangePencil}}),i("color-picker",{attrs:{isActive:t.isDrawing,isOpen:t.isShowingPalette,color:this.color,palette:this.palette},on:{TogglePalette:t.onPickColor,change:t.onChangeColor}}),i("button-simple",{class:{"playlist-button":!0,"flexrow-item":!0,active:t.isDrawing},attrs:{icon:"pencil"},on:{click:t.onAnnotateClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"remove"},on:{click:t.onDeleteClicked}}),i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"comment"},on:{click:t.onCommentClicked}}),i("button-simple",{staticClass:"playlist-button flexrow-item",attrs:{icon:"film"},on:{click:t.onFilmClicked}}),i("div",{staticClass:"flexrow-item playlist-button",staticStyle:{position:"relative"}},[i("a",{class:{"dl-button":!0,"zip-button":!0,hidden:t.isDlButtonsHidden},attrs:{href:t.zipDlPath}},[t._v(" "+t._s(t.$t("playlists.download_zip"))+" ")]),t.isCurrentUserManager?i("span",{class:{"dl-button":!0,"mp4-button":!0,hidden:t.isDlButtonsHidden},on:{click:t.onBuildClicked}},[t._v(" "+t._s(t.$t("playlists.build_mp4"))+" ")]):t._e(),i("div",{class:{"build-list":!0,hidden:t.isDlButtonsHidden}},[t.playlist.build_jobs&&0!==t.playlist.build_jobs.length?i("div",[i("div",{staticClass:"build-title"},[t._v(" "+t._s(t.$t("playlists.available_build"))+" ")]),t._l(t.playlist.build_jobs,(function(e){return i("div",{key:e.id,staticClass:"flexrow"},[i("a",{staticClass:"flexrow-item",attrs:{href:t.getBuildPath(e)}},[t._v(" "+t._s(t.formatDate(e.created_at))+" ")]),i("span",{staticClass:"filler"}),"running"===e.status?i("spinner",{staticClass:"build-spinner"}):i("button",{staticClass:"delete-job-button",on:{click:function(i){return t.onRemoveBuildJob(e)}}},[t._v(" x ")])],1)}))],2):i("span",[t._v(" "+t._s(t.$t("playlists.no_build"))+" ")])]),i("button-simple",{staticClass:"playlist-button",attrs:{icon:"download"},on:{click:t.toggleDlButtons}})],1),t.isFullScreenEnabled?i("button-simple",{staticClass:"button playlist-button flexrow-item",attrs:{icon:"maximize"},on:{click:t.onFullscreenClicked}}):t._e()],1):t._e(),t.playlist.id?i("div",{ref:"playlisted-shots",class:{"playlisted-shots":!0,flexrow:!0,hidden:t.isShotsHidden}},[t.isLoading?i("spinner",{staticClass:"spinner"}):t._l(t.shotList,(function(e,s){return i("div",{key:e.id,staticClass:"flexrow-item has-text-centered"},[i("playlisted-shot",{ref:"shot-"+s,refInFor:!0,attrs:{index:s,shot:e,"is-playing":t.playingShotIndex===s},on:{"play-click":t.playShot,"remove-shot":t.removeShot,"preview-changed":t.onPreviewChanged,"shot-dropped":t.onShotDropped}})],1)}))],2):t._e(),i("delete-modal",{attrs:{active:t.modals.delete,"is-loading":t.loading.deletePlaylist,"is-error":t.errors.deletePlaylist,text:t.deleteText,"error-text":t.$t("playlists.delete_error")},on:{confirm:t.confirmRemovePlaylist,cancel:t.hideDeleteModal}})],1)},N=[],q=(i("7db0"),i("c740"),i("caad"),i("d81d"),i("a434"),i("25f0"),i("2532"),i("4d90"),i("7a94")),z=i("bcd2"),U=i("8707"),W=i("de40"),Y=i("7096"),V=i("5f48"),J=i("7f06"),K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flexrow wrapper"},[i("drag",{attrs:{"transfer-data":t.shot.id},on:{drag:t.onDragged}},[i("div",{class:{"playlisted-shot":!0,playing:t.isPlaying}},[i("div",{staticClass:"thumbnail-wrapper",on:{click:function(e){return e.preventDefault(),t.onPlayClick(e)}}},[t.isCurrentUserManager?i("span",{staticClass:"remove-button flexrow-item",attrs:{title:t.$t("playlists.remove")},on:{click:function(e){return e.preventDefault(),t.onRemoveClick(e)}}},[i("x-icon")],1):t._e(),i("light-entity-thumbnail",{attrs:{width:"150px",height:"103px","preview-file-id":t.previewFileId}})],1),i("div",{staticClass:"shot-title"},[t._v(t._s(t.shot.sequence_name)+" / "+t._s(t.shot.name))]),t.taskTypeOptions.length>0?i("div",{staticClass:"preview-choice"},[i("combobox",{ref:"task-type-combobox",attrs:{thin:!0,options:t.taskTypeOptions},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}}),i("combobox",{staticClass:"version-combo",attrs:{thin:!0,options:t.previewFileOptions},model:{value:t.previewFileId,callback:function(e){t.previewFileId=e},expression:"previewFileId"}})],1):i("div",[t._v(" "+t._s(t.$t("playlists.no_preview"))+" ")])])]),i("drop",{on:{drop:t.onDropped}},[i("div",{ref:"drop-area",staticClass:"drop-area"})])],1)},X=[];i("45fc"),i("a9e3");function Q(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function G(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Q(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Z={name:"playlisted-shot",components:{Combobox:P["a"],LightEntityThumbnail:H,XIcon:f["M"]},data:function(){return{taskTypeId:null,previewFileId:this.shot.preview_file_id}},props:{index:{default:0,type:Number},isPlaying:{default:!1,type:Boolean},shot:{default:function(){},type:Object}},mounted:function(){this.setCurrentParameters(),this.setListeners()},computed:G({},Object(p["c"])(["taskTypeMap","isCurrentUserManager"]),{dropArea:function(){return this.$refs["drop-area"]},taskTypeOptions:function(){var t=this;return Object.keys(this.shot.preview_files).map((function(e){return t.taskTypeMap[e]})).sort(d()("priority",1).thenBy("name")).map((function(t){return{label:t.name,value:t.id}}))},previewFileOptions:function(){var t=this.shot.preview_files[this.taskTypeId]||[];return t.map((function(t){return{label:"v".concat(t.revision),value:t.id}}))}}),methods:{getTaskTypeIdForPreviewFile:function(t,e){var i=this;return t.find((function(t){var s=i.shot.preview_files[t];return s.some((function(t){return t.id===e}))}))},setCurrentParameters:function(){var t=Object.keys(this.shot.preview_files);t.length>0&&(this.shot.preview_file_id&&(this.taskTypeId=this.getTaskTypeIdForPreviewFile(t,this.shot.preview_file_id)),this.taskTypeId||(this.taskTypeId=t[0]))},setListeners:function(){this.dropArea.addEventListener("dragover",this.onDragover),this.dropArea.addEventListener("dragleave",this.onDragleave)},onDragged:function(){},onDragleave:function(){this.dropArea.style.background="transparent"},onDragover:function(){this.dropArea.style.background="#00B242"},onDropped:function(t){this.$refs["drop-area"].style.background="transparent",this.$emit("shot-dropped",{before:this.shot.id,after:t})},onPlayClick:function(){this.$emit("play-click",this.index)},onRemoveClick:function(t){t.preventDefault(),t.stopPropagation(),this.$emit("remove-shot",this.shot)}},watch:{taskTypeId:function(){var t=this,e=this.shot.preview_files[this.taskTypeId];if(e&&e.length>0){var i=e.some((function(e){return e.id===t.shot.preview_file_id}));this.previewFileId=i?this.shot.preview_file_id:e[0].id}},previewFileId:function(){this.$emit("preview-changed",this.shot,this.previewFileId)}}},tt=Z,et=(i("215c"),Object(x["a"])(tt,K,X,!1,null,"f045dd04",null)),it=et.exports,st=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"video-wrapper filler flexrow-item"},[i("video",{ref:"player1",attrs:{preload:"auto"},on:{ended:t.playNext}}),i("video",{ref:"player2",attrs:{preload:"auto"},on:{ended:t.playNext}})])},nt=[];function at(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function rt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?at(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):at(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ot={name:"raw-video-player",components:{},props:{shots:{type:Array,default:function(){return[]}}},data:function(){return{currentPlayer:this.player1,isPlaying:!1,nextPlayer:this.player2,playingIndex:0}},mounted:function(){this.resetHeight(),this.$refs.player1.addEventListener("loadedmetadata",this.emitLoadedEvent),window.addEventListener("resize",this.resetHeight)},beforeDestroy:function(){window.removeEventListener("resize",this.resetHeight),this.$refs.player1.removeEventListener("loadedmetadata",this.emitLoadedEvent)},computed:rt({},Object(p["c"])(["currentProduction"]),{container:function(){return this.$refs.container},fps:function(){return this.currentProduction.fps||24},player1:function(){return this.$refs.player1},player2:function(){return this.$refs.player2}}),methods:{emitLoadedEvent:function(t){this.$emit("metadata-loaded",t)},getMoviePath:function(t){return"/api/movies/originals/preview-files/".concat(t,".mp4")},getNextIndex:function(t){var e=t+1>=this.shots.length?0:t+1;while(e!==t&&"mp4"!==this.shots[e].preview_file_extension)e++,e>=this.shots.length&&(e=0);return e},getPreviousIndex:function(t){var e=t-1>=0?t-1:this.shots.length-1;while(e!==t&&"mp4"!==this.shots[e].preview_file_extension)e--,e<0&&(e=this.shots.length);return e},clear:function(){this.currentPlayer&&(this.currentPlayer.src="",this.currentPlayer.removeAttribute("src"),this.currentPlayer.load())},goPreviousFrame:function(){var t=this.currentPlayer.currentTime-1/this.fps;t<0?this.setCurrentTime(0):this.setCurrentTime(t)},goNextFrame:function(){var t=this.currentPlayer.currentTime+1/this.fps;t>this.currentPlayer.duration?this.setCurrentTime(this.video.duration):this.setCurrentTime(t)},loadPreviousShot:function(){this.loadShot(this.getPreviousIndex(this.currentIndex)),this.$emit("shot-change",this.currentIndex)},loadNextShot:function(){this.loadShot(this.getNextIndex(this.currentIndex)),this.$emit("shot-change",this.currentIndex)},loadShot:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<this.shots.length){var e=this.getNextIndex(t),i=this.shots[t],s=this.shots[e];this.currentIndex=t,this.currentPlayer=this.player1,this.nextPlayer=this.player2,this.currentPlayer.removeEventListener("loadedmetadata",this.updateMaxDuration),this.currentPlayer.addEventListener("loadedmetadata",this.updateMaxDuration),this.currentPlayer.src=this.getMoviePath(i.preview_file_id),this.nextPlayer.src=this.getMoviePath(s.preview_file_id),this.currentPlayer.style.display="block",this.nextPlayer.style.display="none",this.resetHeight(),this.currentPlayer.removeEventListener("timeupdate",this.updateTime),this.currentPlayer.addEventListener("timeupdate",this.updateTime),this.$emit("shot-change",this.currentIndex)}},pause:function(){this.currentPlayer&&this.currentPlayer.pause(),this.isPlaying=!1},play:function(){var t=this.shots[this.currentIndex];t&&(t.preview_file_id||this.loadNextShot(),t=this.shots[this.currentIndex],t.preview_file_id&&(this.currentPlayer&&this.currentPlayer.play(),this.isPlaying=!0))},playNext:function(){var t=this.getNextIndex(this.currentIndex);this.currentIndex=t,this.$emit("shot-change",this.currentIndex),this.currentPlayer.style.display="none",this.nextPlayer.style.display="block",this.nextPlayer.play(),this.switchPlayers(),this.updateMaxDuration()},resetHeight:function(){var t=this;this.$nextTick((function(){t.currentPlayer&&(t.currentPlayer.style.height="0px"),t.nextPlayer&&(t.nextPlayer.style.height="0px");var e=t.container.offsetHeight;t.currentPlayer&&(t.currentPlayer.style.height="".concat(e,"px")),t.nextPlayer&&(t.nextPlayer.style.height="".concat(e,"px"))}))},getCurrentTime:function(){return this.currentPlayer.currentTime},setCurrentTime:function(t){t=Object(z["b"])(t,this.fps),this.currentPlayer&&(this.currentPlayer.currentTime=t)},switchPlayers:function(){var t=this.getNextIndex(this.currentIndex),e=this.shots[t];this.tmpPlayer=this.currentPlayer,this.currentPlayer=this.nextPlayer,this.nextPlayer=this.tmpPlayer,this.nextPlayer.src=this.getMoviePath(e.preview_file_id),this.resetHeight(),this.currentPlayer.removeEventListener("timeupdate",this.updateTime),this.nextPlayer.removeEventListener("timeupdate",this.updateTime),this.currentPlayer.addEventListener("timeupdate",this.updateTime)},updateTime:function(t){this.$emit("time-update",t)},updateMaxDuration:function(){this.$emit("max-duration-update",this.currentPlayer.duration)},getWidth:function(){return this.currentPlayer.offsetWidth},getHeight:function(){return this.currentPlayer.offsetHeight},getVideoRatio:function(){return this.getVideoWidth()/this.getVideoHeight()},getVideoWidth:function(){return this.currentPlayer.videoWidth},getVideoHeight:function(){return this.currentPlayer.videoHeight}},watch:{shots:function(){if(this.shots.length>0){this.loadShot(0),this.pause(),this.setCurrentTime(0);var t=this.shots[this.currentIndex];t&&!t.preview_file_id&&this.loadNextShot()}setTimeout(this.resetHeight,300)}}},lt=ot,ct=(i("5995"),Object(x["a"])(lt,st,nt,!1,null,"7d3894d4",null)),dt=ct.exports,ht=i("be83"),ut=i("9d94"),pt=i("9fbc");function ft(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function yt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ft(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var mt={name:"playlist-player",mixins:[pt["a"]],components:{AnnotationBar:U["a"],ButtonSimple:W["a"],ColorPicker:Y["a"],Combobox:P["a"],DeleteModal:V["a"],PencilPicker:J["a"],PlaylistedShot:it,RawVideoPlayer:dt,Spinner:ht["a"],TaskInfo:ut["a"]},props:{playlist:{type:Object,default:function(){}},shots:{type:Object,default:function(){}},isLoading:{type:Boolean,default:!1},isAddingShot:{type:Boolean,default:!1}},data:function(){return{annotations:[],color:"#ff3860",currentTime:"00:00.00",currentTimeRaw:0,forClient:"false",fabricCanvas:null,isDlButtonsHidden:!0,isCommentsHidden:!0,isComparing:!1,isDrawing:!1,isShowingPalette:!1,isShowingPencilPalette:!1,isPlaying:!1,isShotsHidden:!1,maxDuration:"00:00.00",maxDurationRaw:0,palette:["#ff3860","#008732","#5E60BA","#f57f17"],pencil:"big",pencilPalette:["big","medium","small"],playingShotIndex:0,shotList:[],shotListToCompare:[],task:null,taskTypeOptions:[],taskTypeToCompare:null,modals:{edit:!1,delete:!1},loading:{playlists:!1,editPlaylist:!1,deletePlaylist:!1},errors:{playlists:!1,editPlaylist:!1,deletePlaylist:!1},forClientOptions:[{label:this.$t("playlists.for_client"),value:"true"},{label:this.$t("playlists.for_studio"),value:"false"}]}},mounted:function(){var t=this;this.shotList=Object.values(this.shots),this.updateProgressBar(),this.$nextTick((function(){window.addEventListener("keydown",t.onKeyDown,!1),window.addEventListener("resize",t.onWindowResize),t.$el.nomousemove||(t.$el.onmousemove=t.onMouseMove),t.setupFabricCanvas(),t.resetCanvas()}))},beforeDestroy:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("resize",this.onWindowResize),this.$el.onmousemove=null},computed:yt({},Object(p["c"])(["currentProduction","isCurrentUserClient","isCurrentUserManager","taskMap","taskTypeMap","user"]),{isFullScreenEnabled:function(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled||document.createElement("video").webkitRequestFullScreen)},zipDlPath:function(){return"/api/data/playlists/".concat(this.playlist.id,"/download/zip")},canvas:function(){return this.$refs["canvas-wrapper"]},container:function(){return this.$refs.container},currentFrame:function(){return"".concat(Math.floor(this.currentTimeRaw*this.fps)).padStart(3,"0")},fps:function(){return this.currentProduction.fps||24},rawPlayer:function(){return this.$refs["raw-player"]},rawPlayerComparison:function(){return this.$refs["raw-player-comparison"]},progress:function(){return this.$refs.progress},progressBar:function(){return this.$refs["progress-bar"]},progressCursor:function(){return this.$refs["progress-cursor"]},video:function(){return this.$refs.movie},deleteText:function(){return this.playlist?this.$t("playlists.delete_text",{name:this.playlist.name}):""},timezone:function(){return this.user.timezone||u.a.tz.guess()},nbCommentedShots:function(){var t=function(t){return t.is_commented};return this.shotList.filter(t).length}}),methods:yt({},Object(p["b"])(["deletePlaylist","editPlaylist","removeBuildJob","runPlaylistBuild"]),{getBuildPath:function(t){return"/api/data/playlists/".concat(this.playlist.id,"/jobs/").concat(t.id,"/build/mp4")},formatDate:function(t){var e=u.a.tz(t,"UTC").tz(this.timezone);return e.format("YYYY-MM-DD HH:mm")},formatTime:function(t){var e=".".concat(Math.round(t%1*100));2===e.length&&(e+="0");try{return new Date(1e3*t).toISOString().substr(14,5)+e}catch(i){return console.error(i),"00:00.00"}},getTimelinePosition:function(t,e){if(this.$refs.movie&&this.progress){var i=Math.round(t/this.$refs.movie.duration*this.progress.offsetWidth);return i=i-10*e-5,i<0&&(i=0),i+10>this.progress.offsetWidth&&(i-=5),i}return 0},displayBars:function(){this.$refs["button-bar"]&&(this.$refs.header.style.display="flex",this.$refs["button-bar"].style.display="flex",this.$refs["button-bar"]&&(this.$refs["playlist-progress"].style.display="flex",this.$refs["button-bar"].style.opacity=1,this.$refs["playlist-progress"].style.opacity=1),this.$refs.header.style.opacity=1,this.container.style.cursor="default")},hideBars:function(){var t=this;this.$refs.header.style.opacity=0,this.$refs["button-bar"].style.opacity=0,this.$refs["playlist-progress"].style.opacity=0,setTimeout((function(){t.$refs.header.style.display="none",t.$refs["button-bar"].style.display="none",t.$refs["playlist-progress"].style.display="none",t.container.style.cursor="none"}),500)},showDeleteModal:function(){this.modals.delete=!0},hideDeleteModal:function(){this.modals.delete=!1},confirmRemovePlaylist:function(){var t=this;this.loading.deletePlaylist=!0,this.errors.deletePlaylist=!1,this.deletePlaylist({playlist:this.playlist,callback:function(e){e&&(t.errors.deletePlaylist=!0),t.loading.deletePlaylist=!1,t.$emit("playlist-deleted"),t.modals.delete=!1}})},updateProgressBar:function(){if(this.progress){var t=this.currentTimeRaw/this.maxDurationRaw;this.progress.value=this.currentTimeRaw,this.progressBar.style.width=Math.floor(100*t)+"%"}},updateTaskPanel:function(){if(this.shotList.length>0){var t=this.shotList[this.playingShotIndex];this.task=t?this.taskMap[t.preview_file_task_id]:null}else this.task=null},scrollToShot:function(t){var e=this.$refs["shot-"+t];if(e&&e[0]){var i=e[0].$el,s=this.$refs["playlisted-shots"],n=this.shotList[t];if(this.annotations=n.preview_file_annotations||[],i){var a=30,r=i.getBoundingClientRect(),o=s.getBoundingClientRect(),l=r.right>o.right-a,c=r.left<o.left-a;if(c){var d=r.left-o.left-a;s.scrollLeft=s.scrollLeft+d}else if(l){var h=r.right-o.right+a;s.scrollLeft=s.scrollLeft+h}}}},scrollToRight:function(){this.shotList.length>0&&this.scrollToShot(this.shotList.length-1)},play:function(){this.rawPlayer.play(),this.isComparing&&this.$refs["raw-player-comparison"].play(),this.isPlaying=this.$refs["raw-player"].isPlaying,this.hideCanvas(),this.clearCanvas()},pause:function(){this.showCanvas(),this.rawPlayer&&this.rawPlayer.pause(),this.isComparing&&this.$refs["raw-player-comparison"].pause(),this.isPlaying=!1},playShot:function(t){var e=this.shotList[t];this.hideCanvas(),this.clearCanvas(),"mp4"===e.preview_file_extension?(this.annotations=e.preview_file_annotations||[],this.playingShotIndex=t,this.scrollToShot(this.playingShotIndex),this.rawPlayer.loadShot(t),this.isComparing&&this.$refs["raw-player-comparison"].loadShot(t),this.isPlaying&&(this.rawPlayer.play(),this.isComparing&&this.$refs["raw-player-comparison"].play())):this.annotations=[]},goPreviousFrame:function(){this.clearCanvas(),this.rawPlayer.goPreviousFrame(),this.isComparing&&this.$refs["raw-player-comparison"].goPreviousFrame();var t=this.getAnnotation(this.rawPlayer.getCurrentTime());t&&this.loadAnnotation(t)},goNextFrame:function(){this.clearCanvas(),this.rawPlayer.goNextFrame(),this.isComparing&&this.$refs["raw-player-comparison"].goNextFrame();var t=this.getAnnotation(this.rawPlayer.getCurrentTime());t&&this.loadAnnotation(t)},removeShot:function(t){var e=this;this.$emit("remove-shot",t),this.$options.silent=!0;var i=this.shotList.findIndex((function(e){return e.id===t.id}));this.shotList.splice(i,1),setTimeout((function(){e.$options.silent=!1}),1e3)},setFullScreen:function(){this.container.requestFullscreen?this.container.requestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullScreen?this.container.webkitRequestFullScreen():this.container.msRequestFullscreen&&this.container.msRequestFullscreen(),this.container.setAttribute("data-fullscreen",!0)},exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.container.setAttribute("data-fullscreen",!1)},isFullScreen:function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},onProgressBarClicked:function(t){this.clearCanvas();var e=(t.pageX-this.progress.offsetLeft)/this.progress.offsetWidth,i=e*this.maxDurationRaw;this.rawPlayer.setCurrentTime(i),this.isComparing&&this.$refs["raw-player-comparison"].setCurrentTime(i)},onPreviousFrameClicked:function(){this.goPreviousFrame()},onNextFrameClicked:function(){this.goNextFrame()},onPlayPreviousShotClicked:function(){this.rawPlayer.loadPreviousShot(),this.isComparing&&this.$refs["raw-player-comparison"].loadPreviousShot(),this.isPlaying&&this.play()},onPlayNextShotClicked:function(){this.rawPlayer.loadNextShot(),this.isComparing&&this.$refs["raw-player-comparison"].loadNextShot(),this.isPlaying&&this.play()},onPlayPauseClicked:function(){this.isPlaying?this.pause():this.play()},onFullscreenClicked:function(){this.isFullScreen()?this.exitFullScreen():this.setFullScreen()},onKeyDown:function(t){this.displayBars(),["INPUT","TEXTAREA"].includes(t.target.tagName)||(46===t.keyCode&&this.fabricCanvas?this.deleteSelection():37===t.keyCode?(t.preventDefault(),t.stopPropagation(),this.goPreviousFrame()):39===t.keyCode?(t.preventDefault(),t.stopPropagation(),this.goNextFrame()):32===t.keyCode?(t.preventDefault(),t.stopPropagation(),this.onPlayPauseClicked()):t.ctrlKey&&t.altKey&&68===t.keyCode?this.onAnnotateClicked():t.ctrlKey&&90===t.keyCode?this.undoLastAction():t.altKey&&82===t.keyCode&&this.redoLastAction())},onWindowResize:function(){var t=this,e=(new Date).getTime();this.lastCall=this.lastCall||0,e-this.lastCall>600&&(this.lastCall=e,setTimeout((function(){t.resetHeight(),t.resetCanvas(),t.reloadAnnotations()}),100))},reloadAnnotations:function(){var t=this,e=this.annotations.map((function(t){return yt({},t)}));this.annotations=[],setTimeout((function(){t.annotations=e;var i=t.getAnnotation(t.currentTimeRaw);i&&t.loadAnnotation(i)}),200)},onFilmClicked:function(){var t=this;this.isShotsHidden=!this.isShotsHidden,this.$nextTick((function(){t.resetHeight(),t.scrollToShot(t.playingShotIndex)}))},onCommentClicked:function(){var t=this,e=this.$refs["video-container"].offsetHeight;this.isCommentsHidden=!this.isCommentsHidden,this.isCommentsHidden||(this.$refs["task-info"].$el.style.height="".concat(e,"px")),this.$nextTick((function(){t.$refs["task-info"].focusCommentTextarea(),t.resetHeight()}))},onCompareClicked:function(){this.isComparing=!this.isComparing},onPlayClicked:function(){this.rawPlayer.isPlaying?this.pause():this.play()},onTimeUpdate:function(){this.rawPlayer.currentPlayer?this.currentTimeRaw=this.rawPlayer.currentPlayer.currentTime:this.currentTimeRaw=0,this.currentTime=this.formatTime(this.currentTimeRaw),this.updateProgressBar()},onMaxDurationUpdate:function(t){this.maxDurationRaw=t,this.maxDuration=this.formatTime(t),this.progress&&this.progress.setAttribute("max",this.maxDurationRaw)},onMouseMove:function(){var t=this,e=this.$refs["button-bar"];e&&1!==e.style.opacity&&this.displayBars();var i=this.isFullScreen()&&this.isShotsHidden&&this.isCommentsHidden;i&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){var e=t.isFullScreen()&&t.isShotsHidden&&t.isCommentsHidden;e&&t.hideBars()}),2e3))},onShotChange:function(t){if(this.playingShotIndex=t,this.rawPlayerComparison){var e=this.rawPlayerComparison.playingIndex;e<t?this.rawPlayerComparison.playNext():(this.rawPlayerComparison.setCurrentTime(0),this.rawPlayerComparison.play())}this.$options.silent||this.scrollToShot(this.playingShotIndex)},onPreviewChanged:function(t,e){this.$emit("preview-changed",t,e)},onShotDropped:function(t){this.$emit("order-change",t)},resetHeight:function(){var t=this;this.$nextTick((function(){var e=t.container?t.container.offsetHeight:0;e-=t.$refs.header?t.$refs.header.offsetHeight:0,t.$refs["playlist-progress"]&&(e-=t.$refs["playlist-progress"].offsetHeight),t.$refs["button-bar"]&&(e-=t.$refs["button-bar"].offsetHeight),t.$refs["playlisted-shots"]&&(e-=t.$refs["playlisted-shots"].offsetHeight),t.$refs["playlist-annotation"]&&(e-=t.$refs["playlist-annotation"].$el.offsetHeight),t.$refs["video-container"]&&(t.$refs["video-container"].style.height="".concat(e,"px")),t.isCommentsHidden||(t.$refs["task-info"].$el.style.height="".concat(e,"px")),t.rawPlayer&&t.rawPlayer.resetHeight(),t.isComparing&&t.$refs["raw-player-comparison"].resetHeight(),t.$nextTick((function(){t.resetCanvas(),t.updateProgressBar()}))}))},resetCanvas:function(){this.resetCanvasSize(),this.fabricCanvas.renderAll(),this.clearCanvas()},resetCanvasSize:function(){var t=this;this.rawPlayer&&this.$nextTick((function(){if(t.$refs["canvas-wrapper"]){var e=t.rawPlayer.getVideoRatio(),i=t.rawPlayer.$el.offsetWidth,s=t.rawPlayer.$el.offsetHeight,n=e?s*e:i;if(i>n){var a=Math.round((i-n)/2);t.$refs["canvas-wrapper"].style.left=a+"px",t.$refs["canvas-wrapper"].style.top="0px",t.fabricCanvas.setDimensions({width:n,height:s})}else{var r=e?Math.round(i/e):s,o=Math.round((s-r)/2);t.$refs["canvas-wrapper"].style.left="0px",t.$refs["canvas-wrapper"].style.top=o+"px",t.fabricCanvas.setDimensions({width:i,height:r})}}}))},rebuildComparisonOptions:function(){var t=this,e=Object.values(this.shots);if(e.length>0){var i=Object.keys(e[0].preview_files);Object.values(this.shots).forEach((function(t){var e=Object.keys(t.preview_files);i=i.filter((function(t){return e.includes(t)}))})),this.taskTypeOptions=i.map((function(e){return{label:t.taskTypeMap[e].name,value:t.taskTypeMap[e].id}})),this.taskTypeOptions.length>0&&(this.taskTypeToCompare=this.taskTypeOptions[0].value)}else this.taskTypeOptions=[]},rebuildShotListToCompare:function(){var t=this;this.taskTypeToCompare?this.shotListToCompare=this.shotList.map((function(e){var i=e.preview_files[t.taskTypeToCompare][0];return{preview_file_id:i.id,preview_file_extension:"mp4"}})):this.buildShotListToCompare=[]},resetComparison:function(){var t=this;this.rebuildShotListToCompare(),this.$nextTick((function(){t.pause();var e=t.$refs["raw-player-comparison"];e.loadShot(t.playingShotIndex),e.setCurrentTime(t.currentTimeRaw)}))},clearCanvas:function(){this.fabricCanvas&&this.fabricCanvas.clear()},onAnnotateClicked:function(){this.showCanvas(),this.isDrawing?(this.fabricCanvas.isDrawingMode=!1,this.isDrawing=!1):(this.fabricCanvas.isDrawingMode=!0,this.isDrawing=!0)},showCanvas:function(){this.canvas&&(this.canvas.style.display="block")},hideCanvas:function(){this.canvas&&(this.canvas.style.display="none")},loadAnnotation:function(t){var e=this;this.pause();var i=t.time||0;if(this.rawPlayer){this.rawPlayer.setCurrentTime(i),this.isComparing&&this.$refs["raw-player-comparison"].setCurrentTime(i),this.currentTimeRaw=i,this.updateProgressBar(),this.fabricCanvas.isDrawingMode=!1,this.isDrawing=!1,this.clearCanvas();var s=1,n=1;t.width&&(s=this.fabricCanvas.width/t.width,n=this.fabricCanvas.width/t.width),t.height&&(n=this.fabricCanvas.height/t.height),t.drawing.objects.forEach((function(t){var i={left:t.left*s,top:t.top*n,fill:"transparent",stroke:t.stroke,strokeWidth:t.strokeWidth,radius:t.radius,width:t.width,height:t.height,scaleX:t.scaleX*s,scaleY:t.scaleY*n};if("path"===t.type){var a=1;t.canvasWidth&&(a=t.canvasWidth/e.fabricCanvas.width);var r=new q["fabric"].Path(t.path,yt({},i,{strokeWidth:t.strokeWidth*a,canvasWidth:t.canvasWidth}));r.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1}),e.fabricCanvas.add(r)}}))}},saveAnnotations:function(){var t=Object(z["b"])(this.currentTimeRaw,this.fps)||0;if(this.annotations){var e=this.getAnnotation(t),i=this.getNewAnnotations(t,e),s=this.shotList[this.playingShotIndex],n={id:s.preview_file_id,task_id:s.preview_file_task_id,annotations:s.preview_file_annotations};this.$emit("annotationchanged",{preview:n,annotations:i})}},onDeleteClicked:function(){this.deleteSelection()},getAnnotation:function(t){return t=Object(z["b"])(t,this.fps),this.annotations?this.annotations.find((function(e){return e.time===t})):null},toggleDlButtons:function(){this.isDlButtonsHidden=!this.isDlButtonsHidden},onBuildClicked:function(){this.runPlaylistBuild(this.playlist)},onRemoveBuildJob:function(t){t.playlist_id=this.playlist.id,this.removeBuildJob(t)},onMetadataLoaded:function(t){var e=this;this.$nextTick((function(){e.resetCanvasSize()}))}}),watch:{playingShotIndex:function(){this.updateTaskPanel(),this.resetUndoStacks()},isComparing:function(){this.isComparing&&this.resetComparison(),this.$nextTick(this.resetCanvas)},taskTypeToCompare:function(){this.isComparing&&this.resetComparison()},shots:function(){var t=this,e=this.$refs["playlisted-shots"],i=e?e.scrollLeft:0;this.shotList=Object.values(this.shots),this.playingShotIndex=0,this.pause(),this.rawPlayer&&this.rawPlayer.setCurrentTime(0),this.currentTimeRaw=0,this.updateProgressBar(),this.updateTaskPanel(),this.rebuildComparisonOptions(),this.clearCanvas(),this.annotations=[],0===this.shotList.length?(this.rawPlayer&&this.rawPlayer.clear(),this.isComparing&&this.$refs["raw-player-comparison"].clear(),this.maxDurationRaw=0,this.maxDuration="00:00.00"):("mp4"!==this.shotList[0].preview_file_extension&&this.$nextTick((function(){t.rawPlayer.loadNextShot()})),this.$nextTick((function(){e&&(e.scrollLeft=i)}))),this.resetHeight(),this.resetCanvas()},forClient:function(){var t="true"===this.forClient;this.playlist.for_client!==t&&this.$emit("for-client-changed",t)},playlist:function(){var t=this;this.forClient=Boolean(this.playlist.for_client).toString(),this.$nextTick((function(){t.updateProgressBar(),t.clearCanvas()}))},isAddingShot:function(){var t=this;this.$nextTick((function(){t.updateProgressBar()}))}}},vt=mt,gt=(i("2067"),Object(x["a"])(vt,R,N,!1,null,"4fa4158c",null)),Pt=gt.exports,bt=i("4d04");function wt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ct(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var _t={name:"productions",components:{ErrorText:j,EditPlaylistModal:S,LightEntityThumbnail:H,PageSubtitle:B["a"],PlaylistPlayer:Pt,PlusIcon:f["A"],SearchField:bt["a"],Spinner:ht["a"],XIcon:f["M"]},data:function(){return{currentPlaylist:{name:this.$t("playlists.no_selection")},currentShot:0,currentShots:{},isAddingShot:!0,playlistToEdit:{name:"".concat(u()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},sequenceId:null,sequenceOptions:[],sequenceShots:[],modals:{isDeleteDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,deletePlaylist:!1,editPlaylist:!1,playlist:!1,playlists:!0},errors:{addPlaylist:!1,editPlaylist:!1,deletePlaylist:!1,playlistLoading:!1}}},computed:Ct({},Object(p["c"])(["currentEpisode","currentProduction","displayedShots","displayedShotsBySequence","episodes","isShotsLoading","isTVShow","isCurrentUserManager","playlistMap","playlists","playlistsPath","playlistMap","sequences","shotsByEpisode","shotSearchText","shotMap","taskTypeMap"]),{isAdditionLoading:function(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},lastPlaylistsUpdated:function(){return this.playlists.concat().sort(d()("updated_at")).reverse().slice(0,3)},lastPlaylistsCreated:function(){return this.playlists.slice(0,3)},playlistPlayer:function(){return this.$refs["playlist-player"]}}),methods:Ct({},Object(p["b"])(["addNewBuildJob","addShotPreviewToPlaylist","changePlaylistOrder","changePlaylistPreview","displayMoreShots","editPlaylist","getPending","loadPlaylist","loadPlaylists","loadShotPreviewFiles","loadShots","markBuildJobAsDone","newPlaylist","refreshPlaylist","removeShotPreviewFromPlaylist","removeBuildJobFromList","setShotSearch","updatePreviewAnnotation"]),{formatDate:function(t){return Object(y["a"])(t)},getPlaylistPath:function(t,e){var i={name:e?"".concat(e,"-playlist"):"playlist",params:{production_id:this.currentProduction.id,playlist_id:t}};return this.isTVShow&&this.currentEpisode&&(i.name="episode-".concat(i.name),i.params.episode_id=this.currentEpisode.id),i},loadShotsData:function(t){var e=this;this.loading.playlists=!0;var i=function(){e.loadPlaylistsData(),t&&t()};0===this.displayedShots.length?this.loadShots(i):i()},loadPlaylistsData:function(){var t=this,e=function(){t.setCurrentPlaylist((function(){t.currentPlaylist&&t.currentPlaylist.id||t.goFirstPlaylist()}))};0===this.playlists.length?(this.loading.playlists=!0,this.loadPlaylists((function(i){i&&(t.errors.loadPlaylists=!0),t.loading.playlists=!1,i||e()}))):(this.loading.playlists=!1,e())},rebuildCurrentShots:function(){var t=this;this.currentShots={};var e={};this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach((function(i){t.addShotToCurrentShots(i,e)})),this.$nextTick((function(){t.currentShots=e}))},addShotToCurrentShots:function(t,e){var i=this.shotMap[t.shot_id];if(i){var s=i.tasks.length>0?i.tasks[0].entity_name:i.name,n={id:t.shot_id,name:i.name,sequence_name:i.sequence_name,entity_name:s,preview_files:t.preview_files,preview_file_id:t.id||t.preview_file_id||i.preview_file_id,preview_file_extension:t.extension||t.preview_file_extension||i.preview_file_extension,preview_file_task_id:t.task_id||t.preview_file_task_id||i.preview_file_task_id,preview_file_annotations:t.annotations||t.preview_file_annotations||i.preview_file_annotations};return l.a.set(e,t.shot_id,n),n}return null},clearCurrentPlaylist:function(){this.currentPlaylist={},this.currentShots={}},resetPlaylist:function(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},setCurrentPlaylist:function(t){var e=this,i=this.$route.params.playlist_id,s=this.playlistMap[i];this.loading.playlist=!0,s?this.loadPlaylist({playlist:s,callback:function(i,s){e.loading.playlist=!1,i&&console.error(i),e.currentPlaylist=s,e.rebuildCurrentShots(),t&&t()}}):(this.currentPlaylist={name:this.$t("playlists.no_selection")},this.currentShots={})},goFirstPlaylist:function(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},clearAdditionColumn:function(){this.sequenceOptions=[],this.sequenceId=null},addShot:function(t){var e=this;return this.loadShotPreviewFiles(t).then((function(i){return e.addShotPreviewToPlaylist({playlist:e.currentPlaylist,previewFiles:i,shot:Ct({},t)})})).then((function(t){return new Promise((function(i,s){var n=e.addShotToCurrentShots(t,e.currentShots);e.$refs["playlist-player"].shotList.push(n),e.$nextTick((function(){e.$refs["playlist-player"].scrollToRight(),i()}))}))})).catch((function(t){return console.error(t)}))},addShotToPlaylist:function(t){var e=this;this.currentShots[t.id]||(this.$options.silent=!0,this.addShot(t).then((function(){e.playlistPlayer.scrollToRight(),setTimeout((function(){e.$options.silent=!1}),500)})))},addCurrentSelection:function(t){var e=this;this.$options.silent=!0;var i={};this.displayedShots.forEach((function(t){i[t.id]=!0}));var s=Object.values(this.shotMap).filter((function(t){return!0===i[t.id]})).reverse();this.addShots(s,(function(){e.$options.silent=!1}))},addSequence:function(t){var e=this;if(t.length>0){var i=t[0].sequence_id,s=Object.values(this.shotMap).filter((function(t){return t.sequence_id===i})).sort(d()("name")).reverse();this.$options.silent=!0,this.addShots(s,(function(){e.$options.silent=!1}))}},addAllPending:function(){var t=this;this.$options.silent=!0,this.loading.addWeekly=!0,this.getPending(!1).then((function(e){t.addShots(e.reverse(),(function(){t.loading.addWeekly=!1,t.$options.silent=!1}))}))},addDailyPending:function(){var t=this;this.loading.addDaily=!0,this.$options.silent=!0,this.getPending(!0).then((function(e){t.addShots(e.reverse(),(function(){t.loading.addDaily=!1,t.$options.silent=!1}))}))},addEpisodePending:function(){var t,e=this;this.loading.addEpisode=!0,this.$options.silent=!0;var i=(t=[]).concat.apply(t,Object(a["a"])(this.shotsByEpisode)).reverse();this.addShots(i,(function(){e.loading.addEpisode=!1,e.$options.silent=!1}))},addMovie:function(){var t=this;this.loading.addMovie=!0,this.$options.silent=!0;var e=Object.values(this.shotMap);this.addShots(e,(function(){t.loading.addMovie=!1,t.$options.silent=!1}))},addShots:function(t,e){var i=this;if(t&&t.length>0){var s=t.pop();this.addShot(s).then((function(){i.addShots(t,e)}))}else e()},removeShot:function(t){var e=this;this.removeShotPreviewFromPlaylist({playlist:this.currentPlaylist,shot:t,callback:function(){delete e.currentShots[t.id]}})},onPreviewChanged:function(t,e){this.changePlaylistPreview({playlist:this.currentPlaylist,shot:t,previewFileId:e})},onOrderChange:function(t){this.changePlaylistOrder({playlist:this.currentPlaylist,info:t})},onAnnotationChanged:function(t){var e=t.preview,i=t.annotations,s=e.task_id;this.updatePreviewAnnotation({taskId:s,preview:e,annotations:i})},onForClientChanged:function(t){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:t}})},toggleAddShots:function(){this.isAddingShot&&this.resetPlaylist(),this.isAddingShot=!this.isAddingShot},onSearchChange:function(t){t.length>1?(this.setShotSearch(t),this.displayMoreShots(),this.displayMoreShots(),this.displayMoreShots()):this.setShotSearch("")},confirmEditPlaylist:function(t){this.playlistToEdit.id?(t.id=this.currentPlaylist.id,this.runEditPlaylist(t)):this.runAddPlaylist(t)},runEditPlaylist:function(t){var e=this;this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{name:t.name,for_client:t.for_client,id:t.id},callback:function(t,i){t&&(e.errors.editPlaylist=!0),e.loading.editPlaylist=!1,e.modals.isEditDisplayed=!1,Object.assign(e.currentPlaylist,i)}})},runAddPlaylist:function(t){var e=this,i={name:t.name,production_id:this.currentProduction.id,for_client:t.for_client};this.isTVShow&&this.currentEpisode&&(i.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist({data:i,callback:function(t,i){t&&(e.errors.editPlaylist=!0),e.$router.push(e.getPlaylistPath(i.id)),e.loading.editPlaylist=!1,e.modals.isEditDisplayed=!1}})},showAddModal:function(){this.playlistToEdit={name:"".concat(u()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},this.$refs["edit-playlist-modal"]=!0,this.modals.isEditDisplayed=!0},showEditModal:function(){this.playlistToEdit=this.currentPlaylist,this.modals.isEditDisplayed=!0},hideEditModal:function(){this.playlistToEdit={name:"".concat(u()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},this.modals.isEditDisplayed=!1}}),mounted:function(){var t=this;this.loadShotsData((function(){t.resetPlaylist()}))},watch:{$route:function(){this.setCurrentPlaylist()},currentPlaylist:function(){this.currentPlaylist.shots&&(this.isAddingShot=0===this.currentPlaylist.shots.length)},currentProduction:function(){var t=this;this.$store.commit("LOAD_SEQUENCES_END",[]),this.$store.commit("LOAD_PLAYLISTS_END",[]),this.loadShotsData((function(){t.resetPlaylist()}))},currentEpisode:function(){var t=this;this.$store.commit("LOAD_SEQUENCES_END",[]),this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.loadShotsData((function(){t.resetPlaylist()}))},isAddingShot:function(){this.isAddingShot}},metaInfo:function(){return this.isTVShow?{title:"".concat(this.currentProduction?this.currentProduction.name:""," ")+"- ".concat(this.currentEpisode?this.currentEpisode.name:""," |")+" ".concat(this.$t("playlists.title")," - Kitsu")}:{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" ".concat(this.$t("playlists.title"))+" - Kitsu"}},socket:{events:{"playlist:new":function(t){this.playlistMap[t.playlist_id]||this.refreshPlaylist(t.playlist_id)},"playlist:update":function(t){this.playlistMap[t.playlist_id]&&this.$options.silent},"playlist:delete":function(t){this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update":function(t){t.playlist_id===this.currentPlaylist.id&&Object(m["f"])(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=Object(m["e"])(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}}},xt=_t,kt=(i("fad0"),Object(x["a"])(xt,s,n,!1,null,"32cd5cc4",null));e["default"]=kt.exports},e173:function(t,e,i){},e92a:function(t,e,i){},fad0:function(t,e,i){"use strict";var s=i("45df"),n=i.n(s);n.a}}]);
//# sourceMappingURL=chunk-4c6fff1f.3966875f.js.map