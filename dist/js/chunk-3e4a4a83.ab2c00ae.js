(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e4a4a83"],{"37b1":function(e,t,n){"use strict";var i=n("ddaa"),s=n.n(i);s.a},"3a9d":function(e,t,n){"use strict";var i=n("b0dcb"),s=n.n(i);s.a},9633:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"columns fixed-page"},[n("div",{staticClass:"column main-column"},[n("div",{staticClass:"flexrow project-dates"},[n("div",{staticClass:"flexrow-item"},[n("label",{staticClass:"label"},[e._v("\n          "+e._s(e.$t("main.start_date"))+"\n        ")]),n("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"d MMMM yyyy"},model:{value:e.selectedStartDate,callback:function(t){e.selectedStartDate=t},expression:"selectedStartDate"}})],1),n("div",{staticClass:"flexrow-item field"},[n("label",{staticClass:"label"},[e._v("\n          "+e._s(e.$t("main.end_date"))+"\n        ")]),n("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"d MMMM yyyy"},model:{value:e.selectedEndDate,callback:function(t){e.selectedEndDate=t},expression:"selectedEndDate"}})],1),n("text-field",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"flexrow-item overall-man-days",attrs:{type:"number",label:e.$t("schedule.overall_man_days"),disabled:!e.isCurrentUserAdmin},model:{value:e.overallManDays,callback:function(t){e.overallManDays=t},expression:"overallManDays"}}),n("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(t){e.zoomLevel=t},expression:"zoomLevel"}})],1),n("schedule",{attrs:{"start-date":e.startDate,"end-date":e.endDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":e.loading.schedule,"is-error":e.errors.schedule},on:{"item-changed":e.saveScheduleItem,"change-zoom":e.changeZoom,"root-element-expanded":e.expandTaskTypeElement}})],1),e.currentTask?n("div",{staticClass:"column side-column is-hidden-mobile hide-small-screen"},[n("task-info",{attrs:{task:e.currentTask,"is-loading":!1}})],1):e._e()])},s=[],a=(n("7f7f"),n("cebc")),r=n("2f62"),l=n("7f45"),o=n.n(l),d=n("2430"),c=n("fa33"),u=n("2229"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isSimple?n("span",{staticClass:"select"},[n("select",{ref:"select",staticClass:"select-input",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.emitEnter()},change:e.updateValue}},e._l(e.options,function(t,i){return n("option",{key:i+"-"+t.label+"-"+t.value,domProps:{value:t.value||t.label,selected:e.value===t.value}},[e._v("\n      "+e._s(e.getOptionLabel(t))+"\n    ")])}),0)]):n("div",{staticClass:"field"},[e.label.length>0?n("label",{staticClass:"label"},[e._v("\n    "+e._s(e.label)+"\n  ")]):e._e(),n("p",{staticClass:"control"},[n("span",{class:{select:!0}},[n("select",{ref:"select",staticClass:"select-input",attrs:{disabled:e.disabled},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.emitEnter()},change:e.updateValue}},e._l(e.options,function(t,i){return n("option",{key:i+"-"+t.label+"-"+t.value,domProps:{value:t.value||t.label,selected:e.value===t.value}},[e._v("\n          "+e._s(e.getOptionLabel(t))+"\n        ")])}),0)])])])},m=[],f=(n("c5f6"),{name:"combobox",props:{label:{default:"",type:String},value:{default:0,type:Number},options:{default:function(){return[]},type:Array},localeKeyPrefix:{default:"",type:String},isSimple:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean}},computed:{},methods:{updateValue:function(){this.$emit("input",parseInt(this.$refs.select.value))},emitEnter:function(){this.$emit("enter",parseInt(this.$refs.select.value))},getOptionLabel:function(e){return this.localeKeyPrefix.length>0?this.$t(this.localeKeyPrefix+e.label.toLowerCase()):e.label}}}),p=f,y=(n("e007"),n("2877")),v=Object(y["a"])(p,h,m,!1,null,"4e1af092",null),D=v.exports,b=n("9d94"),g=n("7bf8"),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schedule-wrapper"},[n("div",{ref:"schedule",class:e.scheduleClass},[n("div",{ref:"entity-list",staticClass:"entities",on:{mousedown:e.startBrowsingY}},[n("div",{staticClass:"has-text-right total-man-days"},[n("span",{staticClass:"mr1"},[e._v(e._s(e.totalManDays))]),n("span",[e._v(e._s(e.$t("schedule.md")))])]),e._l(e.hierarchy,function(t){return n("div",{key:"entity-"+t.id},[n("div",{staticClass:"entity-line entity-name flexrow",style:e.entityLineStyle(t)},[n("span",{staticClass:"expand flexrow-item mr1",on:{click:function(n){return e.expandRootElement(t)}}},[t.expanded?n("chevron-down-icon"):n("chevron-right-icon")],1),n("span",{staticClass:"filler flexrow-item"},[e._v("\n            "+e._s(t.name)+"\n          ")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.man_days,expression:"rootElement.man_days"}],staticClass:"flexrow-item",attrs:{type:"number",placeholder:"0",min:"0"},domProps:{value:t.man_days},on:{input:[function(n){n.target.composing||e.$set(t,"man_days",n.target.value)},function(n){return e.$emit("item-changed",t)}]}}),n("span",{staticClass:"man-days-unit flexrow-item"},[e._v("\n            "+e._s(e.$t("schedule.md"))+"\n          ")])]),t.expanded?n("div",{staticClass:"children"},[t.loading?n("div",{staticClass:"flexrow"},[n("spinner",{staticClass:"child-spinner flexrow-item",staticStyle:{width:"20px",margin:"0 0 10px 10px"}})],1):e._e(),e._l(t.children,function(t){return n("div",{key:"entity-"+t.id,staticClass:"child-name"},[n("div",{staticClass:"entity-line entity-name child-line flexrow"},[n("span",{staticClass:"expand flexrow-item",on:{click:function(n){return e.expandChildElement(t)}}},[n("chevron-right-icon")],1),n("span",{staticClass:"filler flexrow-item"},[e._v("\n                "+e._s(t.name)+"\n              ")])])])})],2):e._e()])})],2),n("div",{staticClass:"timeline"},[n("div",{ref:"timeline-header",staticClass:"timeline-header",on:{mousedown:e.startBrowsingX}},e._l(e.daysAvailable,function(t,i){return n("div",{key:"header-"+t.toISOString(),staticClass:"day",style:e.dayStyle(t)},[t.newMonth||0===i?n("span",{staticClass:"month-name"},[e._v("\n            "+e._s(t.format("MMMM"))+"\n          ")]):e._e(),n("div",{class:e.dayClass(t,i)},[!t.weekend&&e.zoomLevel>2?n("span",[e._v("\n              "+e._s(t.format("ddd")[0])+" /\n            ")]):e._e(),t.weekend?e._e():n("span",{staticClass:"day-number"},[e._v("\n              "+e._s(t.format("DD"))+"\n            ")])])])}),0),n("div",{ref:"timeline-content-wrapper",staticClass:"timeline-content-wrapper"},[n("div",{ref:"timeline-content",staticClass:"timeline-content",on:{mousedown:e.startBrowsing,mousewheel:function(t){return e.$emit("change-zoom",t)}}},[n("div",{ref:"timeline-position",staticClass:"timeline-position",style:e.timelinePositionStyle}),e._l(e.hierarchy,function(t){return n("div",{key:"entity-line-"+t.id},[n("div",{staticClass:"entity-line",style:e.entityLineStyle(t)},[n("div",{staticClass:"timebar",style:e.timebarStyle(t)},[n("div",{class:{"timebar-left-hand":e.isCurrentUserAdmin},on:{mousedown:function(n){return e.moveTimebarLeftSide(t,n)}}}),n("div",{staticClass:"filler",on:{mousedown:function(n){return e.moveTimebar(t,n)}}}),n("div",{class:{"timebar-right-hand":e.isCurrentUserAdmin},on:{mousedown:function(n){return e.moveTimebarRightSide(t,n)}}})])]),t.expanded?n("div",{staticClass:"children"},[t.loading?n("div",{staticClass:"flexrow"},[n("spinner",{staticClass:"child-spinner flexrow-item",staticStyle:{width:"20px",margin:"0 0 10px 10px",opacity:"0"}})],1):e._e(),e._l(t.children,function(t){return n("div",{key:"entity-line-"+t.id,staticClass:"entity-line child-line"},[n("div",{staticClass:"timebar",style:e.timebarStyle(t),attrs:{title:t.name}},[n("div",{class:{"timebar-left-hand":e.isCurrentUserAdmin},on:{mousedown:function(n){return e.moveTimebarLeftSide(t,n)}}}),n("div",{staticClass:"filler",on:{mousedown:function(n){return e.moveTimebar(t,n)}}},[e._v("\n                   "+e._s(t.name)+"\n                  ")]),n("div",{class:{"timebar-right-hand":e.isCurrentUserAdmin},on:{mousedown:function(n){return e.moveTimebarRightSide(t,n)}}})])])})],2):e._e()])})],2)])])]),n("spinner",{staticClass:"mt1"})],1)},C=[],x=(n("ac6a"),n("6762"),n("2fdb"),n("be83")),S=n("0a35"),_={name:"schedule",components:{ChevronDownIcon:S["d"],ChevronRightIcon:S["f"],Spinner:x["a"]},data:function(){return{isBrowsingX:!1,isBrowsingY:!1,isChangeSize:!1,timelineDisplayedDaysIndex:{}}},props:{endDate:{type:Object,required:!0},hierarchy:{default:function(){return[]},type:Array},startDate:{type:Object,required:!0},zoomLevel:{type:Number,default:2},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!0}},mounted:function(){this.resetScheduleSize(),document.addEventListener("mouseup",this.stopBrowsing),document.addEventListener("mousemove",this.onMouseMove),window.addEventListener("resize",this.resetScheduleSize)},destroyed:function(){document.removeEventListener("mouseup",this.stopBrowsing),document.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("resize",this.resetScheduleSize),document.body.style.cursor="default"},computed:Object(a["a"])({},Object(r["c"])(["isCurrentUserAdmin"]),{cellWidth:function(){return 20*this.zoomLevel},daysAvailable:function(){var e=[],t=this.startDate.add(-1,"days"),n=t.toDate(),i=this.endDate.toDate();n.isoweekday=t.isoWeekday(),n.monthday=t.month();while(n<i){var s=new Date(Number(n));s.setDate(n.getDate()+1),s.isoweekday=n.isoweekday+1,s.isoweekday>7&&(s.isoweekday=1,s.newWeek=!0),s.monthday=n.monthday+1,s.monthday>27&&s.getMonth()!==n.getMonth()&&(s.newMonth=!0,s.monthday=1),[6,7].includes(s.isoweekday)&&(s.weekend=!0);var a=o()(s);a.newWeek=s.newWeek,a.newMonth=s.newMonth,a.weekend=s.weekend,e.push(a),n=s}return e},displayedDays:function(){return this.daysAvailable.filter(function(e){return!e.weekend})},nbDisplayedDays:function(){return this.displayedDays.length},displayedDaysIndex:function(){var e=0,t={};return this.displayedDays.forEach(function(n){t[n.format("YYYY-MM-DD")]=e,e++}),t},scheduleClass:function(){var e={schedule:!0,unselectable:!0};return e["zoom-level-"+this.zoomLevel]=!0,e},timelinePositionStyle:function(){return{width:this.cellWidth+"px"}},totalManDays:function(){return this.hierarchy.reduce(function(e,t){var n=e,i=t.man_days;return t.man_days&&("string"===typeof i&&(i=parseInt(i)),n=e+i),n},0)},entityList:function(){return this.$refs["entity-list"]},schedule:function(){return this.$refs["schedule"]},timelineContent:function(){return this.$refs["timeline-content"]},timelineContentWrapper:function(){return this.$refs["timeline-content-wrapper"]},timelineHeader:function(){return this.$refs["timeline-header"]},timelinePosition:function(){return this.$refs["timeline-position"]}}),methods:Object(a["a"])({},Object(r["b"])([]),{resetScheduleSize:function(){this.timelineContent.style.width=this.nbDisplayedDays*this.cellWidth+"px",this.timelineContentWrapper.style.height=this.schedule.offsetHeight-118+"px",this.entityList.style.height=this.schedule.offsetHeight-118+"px"},onMouseMove:function(e){this.isChangeStartDate?this.changeStartDate(e):this.isChangeEndDate?this.changeEndDate(e):this.isChangeDates?this.changeDates(e):(this.isBrowsingX&&this.scrollScheduleLeft(e),this.isBrowsingY&&this.scrollScheduleTop(e)),this.updatePositionBarPosition(e)},updatePositionBarPosition:function(e){var t=this.timelineContentWrapper.scrollLeft+e.clientX;t-=262,t=Math.round(t/this.cellWidth)*this.cellWidth,this.timelinePosition.style.left=t+"px"},changeDates:function(e){var t=e.clientX-this.initialClientX-this.cellWidth/2,n=Math.ceil(t/this.cellWidth),i=this.lastStartDate.format("YYYY-MM-DD"),s=this.lastEndDate.format("YYYY-MM-DD"),a=this.displayedDaysIndex[i],r=this.displayedDaysIndex[s],l=r-a,o=this.displayedDaysIndex[i];o+=n,o<0&&(o=0);var d=this.displayedDays[o];if(d){var c=this.displayedDays[o+l];c&&(this.currentElement.startDate=d,this.currentElement.endDate=c,this.$emit("item-changed",this.currentElement))}},changeStartDate:function(e){var t=e.clientX-this.initialClientX,n=Math.floor(t/this.cellWidth),i=this.lastStartDate.format("YYYY-MM-DD"),s=this.displayedDaysIndex[i];s+=n;var a=this.displayedDays[s];this.currentElement.startDate=a,this.$emit("item-changed",this.currentElement)},changeEndDate:function(e){var t=e.clientX-this.initialClientX+this.cellWidth/2,n=Math.ceil(t/this.cellWidth),i=this.currentElement.startDate.format("YYYY-MM-DD"),s=this.lastEndDate.format("YYYY-MM-DD"),a=this.displayedDaysIndex[i],r=this.displayedDaysIndex[s];r+=n-1,r<a&&(r=a+1),r>this.displayedDaysIndex.length&&(r=this.displayedDaysIndex.length-1);var l=this.displayedDays[r];this.currentElement.endDate=l,this.$emit("item-changed",this.currentElement)},scrollScheduleLeft:function(e){var t=this.timelineContentWrapper.scrollLeft,n=t-e.movementX;this.timelineContentWrapper.scrollLeft=n,this.timelineHeader.scrollLeft=n},scrollScheduleTop:function(e){var t=this.timelineContentWrapper.scrollTop,n=t-e.movementY;this.timelineContentWrapper.scrollTop=n,this.entityList.scrollTop=n},startBrowsing:function(e){this.isChangeStartDate||this.isChangeEndDate||this.isChangeDates||(document.body.style.cursor="grabbing",this.isBrowsingX=!0,this.isBrowsingY=!0)},startBrowsingX:function(e){document.body.style.cursor="grabbing",this.isBrowsingX=!0},startBrowsingY:function(e){document.body.style.cursor="grabbing",this.isBrowsingY=!0},stopBrowsing:function(e){document.body.style.cursor="default",this.isChangeStartDate=!1,this.isChangeEndDate=!1,this.isChangeDates=!1,this.isBrowsingX=!1,this.isBrowsingY=!1},moveTimebar:function(e,t){!this.isChangeStartDate&&this.isCurrentUserAdmin&&(this.isChangeDates=!0,this.isChangeStartDate=!1,this.isChangeEnd=!1,this.currentElement=e,this.lastStartDate=e.startDate.clone(),this.lastEndDate=e.endDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="ew-resize")},moveTimebarLeftSide:function(e,t){!this.isChangeDates&&this.isCurrentUserAdmin&&(this.isChangeDates=!1,this.isChangeStartDate=!0,this.isChangeEnd=!1,this.currentElement=e,this.lastStartDate=e.startDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="w-resize")},moveTimebarRightSide:function(e,t){!this.isChangeDates&&this.isCurrentUserAdmin&&(this.isChangeDates=!1,this.isChangeStartDate=!1,this.isChangeEndDate=!0,this.currentElement=e,this.lastEndDate=e.endDate.clone(),this.initialClientX=t.clientX,document.body.style.cursor="e-resize")},businessDiff:function(e,t){var n=e.clone().endOf("week"),i=t.clone().startOf("week"),s=i.diff(n,"days");if(t.diff(e,"days")>6){var a=5*s/7,r=n.day()-e.day();0===e.day()&&--r;var l=t.day()-i.day();return 6===t.day()&&--l,r+a+l-1}var d=o()(e),c=0;while(d.isBefore(t,"day"))0!==d.day()&&6!==d.day()&&c++,d.add(1,"days");return c},dayClass:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{"day-name":!0,"new-week":e.newWeek||!1,"new-month":e.newMonth||0===t||!1}},dayStyle:function(e){return{"min-width":e.weekend?"0px":this.cellWidth+"px","max-width":e.weekend?"0px":this.cellWidth+"px"}},entityLineStyle:function(e){return{"background-color":e.color}},timebarStyle:function(e){return{left:this.getTimebarLeft(e)+"px",width:this.getTimebarWidth(e)+"px",cursor:this.isCurrentUserAdmin?"ew-resize":"default"}},getTimebarLeft:function(e){var t=e.startDate||this.startDate,n=this.businessDiff(this.startDate,t)||0;return n*this.cellWidth+5},getTimebarWidth:function(e){var t=e.startDate||this.startDate,n=e.endDate||e.startDate&&e.startDate.clone().add(1,"days")||this.startDate.clone().add(1,"days"),i=this.businessDiff(t,n)||1;return(i+1)*this.cellWidth-10},expandRootElement:function(e){this.$emit("root-element-expanded",e)},expandChildElement:function(e){}}),socket:{},watch:{startDate:function(){this.resetScheduleSize()},endDate:function(){this.resetScheduleSize()},zoomLevel:function(){this.resetScheduleSize()},isLoading:function(){this.$nextTick(this.resetScheduleSize)}}},k=_,M=(n("3a9d"),Object(y["a"])(k,w,C,!1,null,"09864d3a",null)),E=M.exports,Y={name:"production-schedule",components:{ComboboxNumber:D,Datepicker:c["a"],Schedule:E,TaskInfo:b["a"],TextField:g["a"]},data:function(){return{currentTask:null,overallManDays:0,endDate:o()().add(6,"months"),scheduleItems:[],startDate:o()(),selectedStartDate:null,selectedEndDate:null,zoomLevel:3,zoomOptions:[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted:function(){this.reset()},computed:Object(a["a"])({},Object(r["c"])(["assetTypeMap","currentEpisode","currentProduction","isCurrentUserAdmin","isTVShow","taskTypeMap","user"]),{locale:function(){return"fr_FR"===this.user.locale?d["fr"]:d["en"]}}),methods:Object(a["a"])({},Object(r["b"])(["editProduction","loadScheduleItems","loadAssetTypeScheduleItems","loadSequenceScheduleItems","loadEpisodeScheduleItems","saveScheduleItem"]),{loadData:function(){var e=this;this.loading.schedule=!0,this.loadScheduleItems(this.currentProduction).then(function(t){t=t.map(function(t){var n=e.taskTypeMap[t.task_type_id];return Object(a["a"])({},t,{color:n.color,for_shots:n.for_shots,name:n.name,priority:n.priority,startDate:o()(t.start_date,"YYYY-MM-DD"),endDate:o()(t.end_date,"YYYY-MM-DD"),expanded:!1,loading:!1,children:[]})}),e.scheduleItems=Object(u["h"])(t,e.taskTypeMap),e.loading.schedule=!1}).catch(function(t){console.error(t),e.loading.schedule=!1})},changeZoom:function(e){e.wheelDelta<0&&this.zoomLevel>1&&this.zoomLevel--,e.wheelDelta>0&&this.zoomLevel<3&&this.zoomLevel++},reset:function(){this.currentProduction.start_date&&(this.startDate=o()(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=o()(this.currentProduction.end_date)),this.overallManDays=this.currentProduction.man_days,this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),this.loadData()},convertScheduleItems:function(e){return e.map(function(e){return Object(a["a"])({},e,{startDate:o()(e.start_date,"YYYY-MM-DD"),endDate:o()(e.end_date,"YYYY-MM-DD"),expanded:!1,loading:!1,children:[]})})},expandTaskTypeElement:function(e){var t=this,n={production:this.currentProduction,taskType:this.taskTypeMap[e.task_type_id]};if(e.expanded=!e.expanded,e.expanded){e.loading=!0;var i="loadAssetTypeScheduleItems";e.for_shots&&(i=this.isTVShow?"loadEpisodeScheduleItems":"loadSequenceScheduleItems"),this[i](n).then(function(n){e.loading=!1,e.children=t.convertScheduleItems(n)}).catch(function(t){console.error(t),e.loading=!1,e.children=[]})}}}),socket:{},watch:{selectedStartDate:function(){this.startDate=o()(this.selectedStartDate),this.editProduction({data:Object(a["a"])({},this.currentProduction,{start_date:this.startDate.format("YYYY-MM-DD")})})},selectedEndDate:function(){this.endDate=o()(this.selectedEndDate),this.editProduction({data:Object(a["a"])({},this.currentProduction,{end_date:this.endDate.format("YYYY-MM-DD")})})},overallManDays:function(){this.overallManDays!==this.currentProduction.man_days&&this.editProduction({data:Object(a["a"])({},this.currentProduction,{man_days:this.overallManDays})})},currentProduction:function(){this.reset()}},metaInfo:function(){return this.isTVShow?{title:"".concat(this.currentProduction?this.currentProduction.name:"")+" - ".concat(this.currentEpisode?this.currentEpisode.name:"")+" | ".concat(this.$t("schedule.title")," - Kitsu")}:{title:"".concat(this.currentProduction.name," ")+"| ".concat(this.$t("schedule.title")," - Kitsu")}}},L=Y,T=(n("37b1"),Object(y["a"])(L,i,s,!1,null,"97ce2faa",null));t["default"]=T.exports},b0dcb:function(e,t,n){},dd1c:function(e,t,n){},ddaa:function(e,t,n){},e007:function(e,t,n){"use strict";var i=n("dd1c"),s=n.n(i);s.a}}]);
//# sourceMappingURL=chunk-3e4a4a83.ab2c00ae.js.map